{"ast":null,"code":"import { groupBy, mapValues, cloneDeep } from 'lodash-es';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/material/table\";\nimport * as i3 from \"../service/table-cell.pipe\";\n\nfunction SumsQcsTableComponent_ng_container_0_th_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"th\", 10);\n  }\n}\n\nfunction SumsQcsTableComponent_ng_container_0_td_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 11);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const element_r6 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(element_r6.key);\n  }\n}\n\nfunction SumsQcsTableComponent_ng_container_0_ng_container_7_th_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 10);\n    i0.ɵɵelementStart(1, \"h3\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const column_r7 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(column_r7);\n  }\n}\n\nfunction SumsQcsTableComponent_ng_container_0_ng_container_7_td_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 11);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"tableCellPipe\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const element_r11 = ctx.$implicit;\n    const column_r7 = i0.ɵɵnextContext().$implicit;\n    const ctx_r9 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind3(2, 1, element_r11[column_r7], ctx_r9.type, null), \" \");\n  }\n}\n\nfunction SumsQcsTableComponent_ng_container_0_ng_container_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0, 12);\n    i0.ɵɵtemplate(1, SumsQcsTableComponent_ng_container_0_ng_container_7_th_1_Template, 3, 1, \"th\", 5);\n    i0.ɵɵtemplate(2, SumsQcsTableComponent_ng_container_0_ng_container_7_td_2_Template, 3, 5, \"td\", 6);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const column_r7 = ctx.$implicit;\n    i0.ɵɵpropertyInterpolate(\"matColumnDef\", column_r7);\n  }\n}\n\nfunction SumsQcsTableComponent_ng_container_0_tr_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 13);\n  }\n}\n\nfunction SumsQcsTableComponent_ng_container_0_tr_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 14);\n  }\n}\n\nfunction SumsQcsTableComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"h2\", 1);\n    i0.ɵɵi18n(2, 2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"table\", 3);\n    i0.ɵɵelementContainerStart(4, 4);\n    i0.ɵɵtemplate(5, SumsQcsTableComponent_ng_container_0_th_5_Template, 1, 0, \"th\", 5);\n    i0.ɵɵtemplate(6, SumsQcsTableComponent_ng_container_0_td_6_Template, 2, 1, \"td\", 6);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵtemplate(7, SumsQcsTableComponent_ng_container_0_ng_container_7_Template, 3, 1, \"ng-container\", 7);\n    i0.ɵɵtemplate(8, SumsQcsTableComponent_ng_container_0_tr_8_Template, 1, 0, \"tr\", 8);\n    i0.ɵɵtemplate(9, SumsQcsTableComponent_ng_container_0_tr_9_Template, 1, 0, \"tr\", 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵi18nExp(ctx_r0.title);\n    i0.ɵɵi18nApply(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"dataSource\", ctx_r0.sumDataSource);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.sumClumensshow);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"matHeaderRowDef\", ctx_r0.sumClumensTable);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"matRowDefColumns\", ctx_r0.sumClumensTable);\n  }\n}\n\nexport class SumsQcsTableComponent {\n  constructor() {\n    this.sumDataSource = [];\n    this.sumCloumns = [];\n  }\n\n  set mainDetailsSource(value) {\n    if (value) {\n      this.dataSource = cloneDeep(value[0]);\n      this.sumCloumns = value[1];\n\n      if (this.sumCloumns.length) {\n        this.sumDataSource = [];\n\n        var nest = function (seq, keys) {\n          if (!keys.length) return seq;\n          var first = keys[0];\n          var rest = keys.slice(1);\n          return mapValues(groupBy(seq, first), function (value) {\n            return nest(value, rest);\n          });\n        };\n\n        const tempTable = nest(this.dataSource, this.sumCloumns);\n        this.sumClumensTable = ['key'];\n        var newSumLine = {\n          key: \"Average\"\n        };\n        Object.keys(tempTable).forEach(key => {\n          var newLine = {};\n          var sum = 0;\n          var diveder = 0;\n          var numChecks = 0;\n          Object.keys(tempTable[key]).forEach(val => {\n            var temp = tempTable[key][val].filter(f => f[value[2]] !== null && f[value[2]] !== undefined);\n\n            if (temp.length) {\n              if (this.type === 'decimalNumber') {\n                newLine[val] = temp.reduce((b, c) => +b + +c[value[2]]['amount'], 0) / temp.length;\n              } else {\n                newLine[val] = temp.reduce((b, c) => +b + +c[value[2]], 0) / temp.length;\n              }\n\n              this.sumClumensTable.push(val);\n              sum += newLine[val];\n              diveder++;\n              numChecks += temp.length;\n              newSumLine[val] = newSumLine[val] ? newSumLine[val] + 1 : 1;\n            }\n          });\n\n          if (numChecks) {\n            newLine['key'] = key !== 'null' ? key + ' (' + numChecks + ')' : 'other (' + numChecks + ')';\n            newLine[\"Average\"] = sum / diveder;\n            this.sumDataSource.push(newLine);\n          }\n        });\n        this.sumClumensTable = [...new Set(this.sumClumensTable)];\n        this.sumClumensTable.push(\"Average\");\n        this.sumClumensTable.forEach(newCloumn => {\n          if (newCloumn === \"Average\") {\n            var sum = 0;\n            var diveder = 0;\n            this.sumDataSource.forEach(aLine => {\n              if (aLine[newCloumn]) {\n                sum += aLine[newCloumn];\n                diveder++;\n              }\n            });\n            newSumLine[newCloumn] = sum / diveder;\n          } else if (newCloumn !== 'key') {\n            var sum = 0;\n            this.sumDataSource.forEach(aLine => {\n              sum += aLine[newCloumn] ? aLine[newCloumn] : 0;\n            });\n            newSumLine[newCloumn] = sum / newSumLine[newCloumn];\n          }\n        });\n        this.sumDataSource.push(newSumLine);\n        this.sumClumensshow = this.sumClumensTable.slice(1);\n      }\n    }\n  }\n\n}\n\nSumsQcsTableComponent.ɵfac = function SumsQcsTableComponent_Factory(t) {\n  return new (t || SumsQcsTableComponent)();\n};\n\nSumsQcsTableComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: SumsQcsTableComponent,\n  selectors: [[\"sums-qc-table\"]],\n  inputs: {\n    title: \"title\",\n    type: \"type\",\n    mainDetailsSource: \"mainDetailsSource\"\n  },\n  decls: 1,\n  vars: 1,\n  consts: function () {\n    let i18n_0;\n\n    if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n      const MSG_EXTERNAL_2999396308623228810$$SRC_APP_REPORTS_SUM_QC_TABLE_COMPONENT_TS__1 = goog.getMsg(\"{$interpolation}\", {\n        \"interpolation\": \"\\uFFFD0\\uFFFD\"\n      });\n      i18n_0 = MSG_EXTERNAL_2999396308623228810$$SRC_APP_REPORTS_SUM_QC_TABLE_COMPONENT_TS__1;\n    } else {\n      i18n_0 = \"\" + \"\\uFFFD0\\uFFFD\" + \"\";\n    }\n\n    return [[4, \"ngIf\"], [2, \"text-align\", \"center\"], i18n_0, [\"mat-table\", \"\", 2, \"text-align\", \"center !important\", 3, \"dataSource\"], [\"matColumnDef\", \"key\"], [\"mat-header-cell\", \"\", 4, \"matHeaderCellDef\"], [\"mat-cell\", \"\", 4, \"matCellDef\"], [3, \"matColumnDef\", 4, \"ngFor\", \"ngForOf\"], [\"mat-header-row\", \"\", 4, \"matHeaderRowDef\"], [\"mat-row\", \"\", 4, \"matRowDef\", \"matRowDefColumns\"], [\"mat-header-cell\", \"\"], [\"mat-cell\", \"\"], [3, \"matColumnDef\"], [\"mat-header-row\", \"\"], [\"mat-row\", \"\"]];\n  },\n  template: function SumsQcsTableComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, SumsQcsTableComponent_ng_container_0_Template, 10, 5, \"ng-container\", 0);\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.sumClumensshow.length > 1);\n    }\n  },\n  directives: [i1.NgIf, i2.MatTable, i2.MatColumnDef, i2.MatHeaderCellDef, i2.MatCellDef, i1.NgForOf, i2.MatHeaderRowDef, i2.MatRowDef, i2.MatHeaderCell, i2.MatCell, i2.MatHeaderRow, i2.MatRow],\n  pipes: [i3.TableCellPipe],\n  encapsulation: 2\n});","map":{"version":3,"sources":["C:/Users/isral/OneDrive/Documents/AVC-FRONT/src/app/reports/sum-qc-table.component.ts"],"names":["groupBy","mapValues","cloneDeep","i0","i1","i2","i3","SumsQcsTableComponent_ng_container_0_th_5_Template","rf","ctx","ɵɵelement","SumsQcsTableComponent_ng_container_0_td_6_Template","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","element_r6","$implicit","ɵɵadvance","ɵɵtextInterpolate","key","SumsQcsTableComponent_ng_container_0_ng_container_7_th_1_Template","column_r7","ɵɵnextContext","SumsQcsTableComponent_ng_container_0_ng_container_7_td_2_Template","ɵɵpipe","element_r11","ctx_r9","ɵɵtextInterpolate1","ɵɵpipeBind3","type","SumsQcsTableComponent_ng_container_0_ng_container_7_Template","ɵɵelementContainerStart","ɵɵtemplate","ɵɵelementContainerEnd","ɵɵpropertyInterpolate","SumsQcsTableComponent_ng_container_0_tr_8_Template","SumsQcsTableComponent_ng_container_0_tr_9_Template","SumsQcsTableComponent_ng_container_0_Template","ɵɵi18n","ctx_r0","ɵɵi18nExp","title","ɵɵi18nApply","ɵɵproperty","sumDataSource","sumClumensshow","sumClumensTable","SumsQcsTableComponent","constructor","sumCloumns","mainDetailsSource","value","dataSource","length","nest","seq","keys","first","rest","slice","tempTable","newSumLine","Object","forEach","newLine","sum","diveder","numChecks","val","temp","filter","f","undefined","reduce","b","c","push","Set","newCloumn","aLine","ɵfac","SumsQcsTableComponent_Factory","t","ɵcmp","ɵɵdefineComponent","selectors","inputs","decls","vars","consts","i18n_0","ngI18nClosureMode","MSG_EXTERNAL_2999396308623228810$$SRC_APP_REPORTS_SUM_QC_TABLE_COMPONENT_TS__1","goog","getMsg","template","SumsQcsTableComponent_Template","directives","NgIf","MatTable","MatColumnDef","MatHeaderCellDef","MatCellDef","NgForOf","MatHeaderRowDef","MatRowDef","MatHeaderCell","MatCell","MatHeaderRow","MatRow","pipes","TableCellPipe","encapsulation"],"mappings":"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","sourcesContent":["import { groupBy, mapValues, cloneDeep } from 'lodash-es';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@angular/common\";\r\nimport * as i2 from \"@angular/material/table\";\r\nimport * as i3 from \"../service/table-cell.pipe\";\r\nfunction SumsQcsTableComponent_ng_container_0_th_5_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelement(0, \"th\", 10);\r\n} }\r\nfunction SumsQcsTableComponent_ng_container_0_td_6_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"td\", 11);\r\n    i0.ɵɵtext(1);\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const element_r6 = ctx.$implicit;\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵtextInterpolate(element_r6.key);\r\n} }\r\nfunction SumsQcsTableComponent_ng_container_0_ng_container_7_th_1_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"th\", 10);\r\n    i0.ɵɵelementStart(1, \"h3\");\r\n    i0.ɵɵtext(2);\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const column_r7 = i0.ɵɵnextContext().$implicit;\r\n    i0.ɵɵadvance(2);\r\n    i0.ɵɵtextInterpolate(column_r7);\r\n} }\r\nfunction SumsQcsTableComponent_ng_container_0_ng_container_7_td_2_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"td\", 11);\r\n    i0.ɵɵtext(1);\r\n    i0.ɵɵpipe(2, \"tableCellPipe\");\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const element_r11 = ctx.$implicit;\r\n    const column_r7 = i0.ɵɵnextContext().$implicit;\r\n    const ctx_r9 = i0.ɵɵnextContext(2);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind3(2, 1, element_r11[column_r7], ctx_r9.type, null), \" \");\r\n} }\r\nfunction SumsQcsTableComponent_ng_container_0_ng_container_7_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementContainerStart(0, 12);\r\n    i0.ɵɵtemplate(1, SumsQcsTableComponent_ng_container_0_ng_container_7_th_1_Template, 3, 1, \"th\", 5);\r\n    i0.ɵɵtemplate(2, SumsQcsTableComponent_ng_container_0_ng_container_7_td_2_Template, 3, 5, \"td\", 6);\r\n    i0.ɵɵelementContainerEnd();\r\n} if (rf & 2) {\r\n    const column_r7 = ctx.$implicit;\r\n    i0.ɵɵpropertyInterpolate(\"matColumnDef\", column_r7);\r\n} }\r\nfunction SumsQcsTableComponent_ng_container_0_tr_8_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelement(0, \"tr\", 13);\r\n} }\r\nfunction SumsQcsTableComponent_ng_container_0_tr_9_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelement(0, \"tr\", 14);\r\n} }\r\nfunction SumsQcsTableComponent_ng_container_0_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementContainerStart(0);\r\n    i0.ɵɵelementStart(1, \"h2\", 1);\r\n    i0.ɵɵi18n(2, 2);\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementStart(3, \"table\", 3);\r\n    i0.ɵɵelementContainerStart(4, 4);\r\n    i0.ɵɵtemplate(5, SumsQcsTableComponent_ng_container_0_th_5_Template, 1, 0, \"th\", 5);\r\n    i0.ɵɵtemplate(6, SumsQcsTableComponent_ng_container_0_td_6_Template, 2, 1, \"td\", 6);\r\n    i0.ɵɵelementContainerEnd();\r\n    i0.ɵɵtemplate(7, SumsQcsTableComponent_ng_container_0_ng_container_7_Template, 3, 1, \"ng-container\", 7);\r\n    i0.ɵɵtemplate(8, SumsQcsTableComponent_ng_container_0_tr_8_Template, 1, 0, \"tr\", 8);\r\n    i0.ɵɵtemplate(9, SumsQcsTableComponent_ng_container_0_tr_9_Template, 1, 0, \"tr\", 9);\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementContainerEnd();\r\n} if (rf & 2) {\r\n    const ctx_r0 = i0.ɵɵnextContext();\r\n    i0.ɵɵadvance(2);\r\n    i0.ɵɵi18nExp(ctx_r0.title);\r\n    i0.ɵɵi18nApply(2);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"dataSource\", ctx_r0.sumDataSource);\r\n    i0.ɵɵadvance(4);\r\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.sumClumensshow);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"matHeaderRowDef\", ctx_r0.sumClumensTable);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"matRowDefColumns\", ctx_r0.sumClumensTable);\r\n} }\r\nexport class SumsQcsTableComponent {\r\n    constructor() {\r\n        this.sumDataSource = [];\r\n        this.sumCloumns = [];\r\n    }\r\n    set mainDetailsSource(value) {\r\n        if (value) {\r\n            this.dataSource = cloneDeep(value[0]);\r\n            this.sumCloumns = value[1];\r\n            if (this.sumCloumns.length) {\r\n                this.sumDataSource = [];\r\n                var nest = function (seq, keys) {\r\n                    if (!keys.length)\r\n                        return seq;\r\n                    var first = keys[0];\r\n                    var rest = keys.slice(1);\r\n                    return mapValues(groupBy(seq, first), function (value) {\r\n                        return nest(value, rest);\r\n                    });\r\n                };\r\n                const tempTable = nest(this.dataSource, this.sumCloumns);\r\n                this.sumClumensTable = ['key'];\r\n                var newSumLine = { key: $localize `Average` };\r\n                Object.keys(tempTable).forEach(key => {\r\n                    var newLine = {};\r\n                    var sum = 0;\r\n                    var diveder = 0;\r\n                    var numChecks = 0;\r\n                    Object.keys(tempTable[key]).forEach(val => {\r\n                        var temp = tempTable[key][val].filter(f => f[value[2]] !== null && f[value[2]] !== undefined);\r\n                        if (temp.length) {\r\n                            if (this.type === 'decimalNumber') {\r\n                                newLine[val] = (temp.reduce((b, c) => +b + +c[value[2]]['amount'], 0)) / temp.length;\r\n                            }\r\n                            else {\r\n                                newLine[val] = (temp.reduce((b, c) => +b + +c[value[2]], 0)) / temp.length;\r\n                            }\r\n                            this.sumClumensTable.push(val);\r\n                            sum += newLine[val];\r\n                            diveder++;\r\n                            numChecks += temp.length;\r\n                            newSumLine[val] = newSumLine[val] ? newSumLine[val] + 1 : 1;\r\n                        }\r\n                    });\r\n                    if (numChecks) {\r\n                        newLine['key'] = key !== 'null' ? key + ' (' + numChecks + ')' : 'other (' + numChecks + ')';\r\n                        newLine[$localize `Average`] = sum / diveder;\r\n                        this.sumDataSource.push(newLine);\r\n                    }\r\n                });\r\n                this.sumClumensTable = [...new Set(this.sumClumensTable)];\r\n                this.sumClumensTable.push($localize `Average`);\r\n                this.sumClumensTable.forEach(newCloumn => {\r\n                    if (newCloumn === $localize `Average`) {\r\n                        var sum = 0;\r\n                        var diveder = 0;\r\n                        this.sumDataSource.forEach(aLine => {\r\n                            if (aLine[newCloumn]) {\r\n                                sum += aLine[newCloumn];\r\n                                diveder++;\r\n                            }\r\n                        });\r\n                        newSumLine[newCloumn] = sum / diveder;\r\n                    }\r\n                    else if (newCloumn !== 'key') {\r\n                        var sum = 0;\r\n                        this.sumDataSource.forEach(aLine => {\r\n                            sum += aLine[newCloumn] ? aLine[newCloumn] : 0;\r\n                        });\r\n                        newSumLine[newCloumn] = sum / newSumLine[newCloumn];\r\n                    }\r\n                });\r\n                this.sumDataSource.push(newSumLine);\r\n                this.sumClumensshow = this.sumClumensTable.slice(1);\r\n            }\r\n        }\r\n    }\r\n}\r\nSumsQcsTableComponent.ɵfac = function SumsQcsTableComponent_Factory(t) { return new (t || SumsQcsTableComponent)(); };\r\nSumsQcsTableComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: SumsQcsTableComponent, selectors: [[\"sums-qc-table\"]], inputs: { title: \"title\", type: \"type\", mainDetailsSource: \"mainDetailsSource\" }, decls: 1, vars: 1, consts: function () { let i18n_0; if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\r\n        const MSG_EXTERNAL_2999396308623228810$$SRC_APP_REPORTS_SUM_QC_TABLE_COMPONENT_TS__1 = goog.getMsg(\"{$interpolation}\", { \"interpolation\": \"\\uFFFD0\\uFFFD\" });\r\n        i18n_0 = MSG_EXTERNAL_2999396308623228810$$SRC_APP_REPORTS_SUM_QC_TABLE_COMPONENT_TS__1;\r\n    }\r\n    else {\r\n        i18n_0 = $localize `:␟045ed332fbb2645493d6955677247db0d1134c2d␟2999396308623228810:${\"\\uFFFD0\\uFFFD\"}:INTERPOLATION:`;\r\n    } return [[4, \"ngIf\"], [2, \"text-align\", \"center\"], i18n_0, [\"mat-table\", \"\", 2, \"text-align\", \"center !important\", 3, \"dataSource\"], [\"matColumnDef\", \"key\"], [\"mat-header-cell\", \"\", 4, \"matHeaderCellDef\"], [\"mat-cell\", \"\", 4, \"matCellDef\"], [3, \"matColumnDef\", 4, \"ngFor\", \"ngForOf\"], [\"mat-header-row\", \"\", 4, \"matHeaderRowDef\"], [\"mat-row\", \"\", 4, \"matRowDef\", \"matRowDefColumns\"], [\"mat-header-cell\", \"\"], [\"mat-cell\", \"\"], [3, \"matColumnDef\"], [\"mat-header-row\", \"\"], [\"mat-row\", \"\"]]; }, template: function SumsQcsTableComponent_Template(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵtemplate(0, SumsQcsTableComponent_ng_container_0_Template, 10, 5, \"ng-container\", 0);\r\n    } if (rf & 2) {\r\n        i0.ɵɵproperty(\"ngIf\", ctx.sumClumensshow.length > 1);\r\n    } }, directives: [i1.NgIf, i2.MatTable, i2.MatColumnDef, i2.MatHeaderCellDef, i2.MatCellDef, i1.NgForOf, i2.MatHeaderRowDef, i2.MatRowDef, i2.MatHeaderCell, i2.MatCell, i2.MatHeaderRow, i2.MatRow], pipes: [i3.TableCellPipe], encapsulation: 2 });\r\n"]},"metadata":{},"sourceType":"module"}