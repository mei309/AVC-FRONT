{"ast":null,"code":"import { groupBy, mapValues, cloneDeep } from 'lodash-es';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/material/table\";\nimport * as i3 from \"../service/table-cell.pipe\";\n\nfunction SumsProductTypeComponent_ng_container_0_th_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"th\", 10);\n  }\n}\n\nfunction SumsProductTypeComponent_ng_container_0_td_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 11);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const element_r6 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(element_r6.key);\n  }\n}\n\nfunction SumsProductTypeComponent_ng_container_0_ng_container_7_th_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 10);\n    i0.ɵɵelementStart(1, \"h3\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const column_r7 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(column_r7);\n  }\n}\n\nfunction SumsProductTypeComponent_ng_container_0_ng_container_7_td_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 11);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"tableCellPipe\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const element_r11 = ctx.$implicit;\n    const column_r7 = i0.ɵɵnextContext().$implicit;\n    const ctx_r9 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind3(2, 1, element_r11[column_r7], ctx_r9.type, null), \" \");\n  }\n}\n\nfunction SumsProductTypeComponent_ng_container_0_ng_container_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0, 12);\n    i0.ɵɵtemplate(1, SumsProductTypeComponent_ng_container_0_ng_container_7_th_1_Template, 3, 1, \"th\", 5);\n    i0.ɵɵtemplate(2, SumsProductTypeComponent_ng_container_0_ng_container_7_td_2_Template, 3, 5, \"td\", 6);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const column_r7 = ctx.$implicit;\n    i0.ɵɵpropertyInterpolate(\"matColumnDef\", column_r7);\n  }\n}\n\nfunction SumsProductTypeComponent_ng_container_0_tr_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 13);\n  }\n}\n\nfunction SumsProductTypeComponent_ng_container_0_tr_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 14);\n  }\n}\n\nfunction SumsProductTypeComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"h2\", 1);\n    i0.ɵɵi18n(2, 2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"table\", 3);\n    i0.ɵɵelementContainerStart(4, 4);\n    i0.ɵɵtemplate(5, SumsProductTypeComponent_ng_container_0_th_5_Template, 1, 0, \"th\", 5);\n    i0.ɵɵtemplate(6, SumsProductTypeComponent_ng_container_0_td_6_Template, 2, 1, \"td\", 6);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵtemplate(7, SumsProductTypeComponent_ng_container_0_ng_container_7_Template, 3, 1, \"ng-container\", 7);\n    i0.ɵɵtemplate(8, SumsProductTypeComponent_ng_container_0_tr_8_Template, 1, 0, \"tr\", 8);\n    i0.ɵɵtemplate(9, SumsProductTypeComponent_ng_container_0_tr_9_Template, 1, 0, \"tr\", 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵi18nExp(ctx_r0.title);\n    i0.ɵɵi18nApply(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"dataSource\", ctx_r0.sumDataSource);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.sumClumensshow);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"matHeaderRowDef\", ctx_r0.sumClumensTable);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"matRowDefColumns\", ctx_r0.sumClumensTable);\n  }\n}\n\nexport class SumsProductTypeComponent {\n  constructor() {\n    this.sumDataSource = [];\n    this.sumCloumns = [];\n  }\n\n  set mainDetailsSource(value) {\n    if (value) {\n      this.dataSource = cloneDeep(value[0]);\n      this.sumCloumns = value[1];\n\n      if (this.sumCloumns.length) {\n        this.sumDataSource = [];\n\n        var nest = function (seq, keys) {\n          if (!keys.length) return seq;\n          var first = keys[0];\n          var rest = keys.slice(1);\n          return mapValues(groupBy(seq, first), function (valu) {\n            return nest(valu, rest);\n          });\n        };\n\n        const tempTable = nest(this.dataSource, this.sumCloumns);\n        this.sumClumensTable = ['key'];\n        var newSumLine = {\n          key: \"Total\"\n        };\n        Object.keys(tempTable).forEach(key => {\n          var newLine = {};\n          var sum = 0;\n          var diveder = 0;\n          var numChecks = 0;\n          Object.keys(tempTable[key]).forEach(val => {\n            var temp = tempTable[key][val].filter(f => f[value[2]] !== null && f[value[2]] !== undefined);\n\n            if (temp.length) {\n              newLine[val] = temp.reduce((b, c) => +b + +c[value[2]], 0);\n              this.sumClumensTable.push(val);\n              sum += newLine[val];\n              diveder++;\n              numChecks += temp.length;\n              newSumLine[val] = newSumLine[val] ? newSumLine[val] + 1 : 1;\n            }\n          });\n\n          if (numChecks) {\n            newLine['key'] = key !== 'null' ? key + ' (' + numChecks + ')' : 'other (' + numChecks + ')';\n            newLine[\"Total\"] = sum;\n            this.sumDataSource.push(newLine);\n          }\n        });\n        this.sumClumensTable = [...new Set(this.sumClumensTable)];\n        this.sumClumensTable.push(\"Total\");\n        this.sumClumensTable.forEach(newCloumn => {\n          if (newCloumn === \"Total\") {\n            var sum = 0;\n            this.sumDataSource.forEach(aLine => {\n              if (aLine[newCloumn]) {\n                sum += aLine[newCloumn];\n              }\n            });\n            newSumLine[newCloumn] = sum;\n          } else if (newCloumn !== 'key') {\n            var sum = 0;\n            this.sumDataSource.forEach(aLine => {\n              sum += aLine[newCloumn] ? aLine[newCloumn] : 0;\n            });\n            newSumLine[newCloumn] = sum;\n          }\n        });\n        this.sumDataSource.push(newSumLine);\n        this.sumClumensshow = this.sumClumensTable.slice(1);\n      }\n    }\n  }\n\n}\n\nSumsProductTypeComponent.ɵfac = function SumsProductTypeComponent_Factory(t) {\n  return new (t || SumsProductTypeComponent)();\n};\n\nSumsProductTypeComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: SumsProductTypeComponent,\n  selectors: [[\"sums-product-type\"]],\n  inputs: {\n    title: \"title\",\n    type: \"type\",\n    mainDetailsSource: \"mainDetailsSource\"\n  },\n  decls: 1,\n  vars: 1,\n  consts: function () {\n    let i18n_0;\n\n    if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n      const MSG_EXTERNAL_2999396308623228810$$SRC_APP_REPORTS_SUM_PRODUCT_TYPE_COMPONENT_TS__1 = goog.getMsg(\"{$interpolation}\", {\n        \"interpolation\": \"\\uFFFD0\\uFFFD\"\n      });\n      i18n_0 = MSG_EXTERNAL_2999396308623228810$$SRC_APP_REPORTS_SUM_PRODUCT_TYPE_COMPONENT_TS__1;\n    } else {\n      i18n_0 = \"\" + \"\\uFFFD0\\uFFFD\" + \"\";\n    }\n\n    return [[4, \"ngIf\"], [2, \"text-align\", \"center\"], i18n_0, [\"mat-table\", \"\", 2, \"text-align\", \"center !important\", 3, \"dataSource\"], [\"matColumnDef\", \"key\"], [\"mat-header-cell\", \"\", 4, \"matHeaderCellDef\"], [\"mat-cell\", \"\", 4, \"matCellDef\"], [3, \"matColumnDef\", 4, \"ngFor\", \"ngForOf\"], [\"mat-header-row\", \"\", 4, \"matHeaderRowDef\"], [\"mat-row\", \"\", 4, \"matRowDef\", \"matRowDefColumns\"], [\"mat-header-cell\", \"\"], [\"mat-cell\", \"\"], [3, \"matColumnDef\"], [\"mat-header-row\", \"\"], [\"mat-row\", \"\"]];\n  },\n  template: function SumsProductTypeComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, SumsProductTypeComponent_ng_container_0_Template, 10, 5, \"ng-container\", 0);\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.sumClumensshow.length > 1);\n    }\n  },\n  directives: [i1.NgIf, i2.MatTable, i2.MatColumnDef, i2.MatHeaderCellDef, i2.MatCellDef, i1.NgForOf, i2.MatHeaderRowDef, i2.MatRowDef, i2.MatHeaderCell, i2.MatCell, i2.MatHeaderRow, i2.MatRow],\n  pipes: [i3.TableCellPipe],\n  encapsulation: 2\n});","map":{"version":3,"sources":["C:/Users/isral/OneDrive/Documents/AVC-FRONT/src/app/reports/sum-product-type.component.ts"],"names":["groupBy","mapValues","cloneDeep","i0","i1","i2","i3","SumsProductTypeComponent_ng_container_0_th_5_Template","rf","ctx","ɵɵelement","SumsProductTypeComponent_ng_container_0_td_6_Template","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","element_r6","$implicit","ɵɵadvance","ɵɵtextInterpolate","key","SumsProductTypeComponent_ng_container_0_ng_container_7_th_1_Template","column_r7","ɵɵnextContext","SumsProductTypeComponent_ng_container_0_ng_container_7_td_2_Template","ɵɵpipe","element_r11","ctx_r9","ɵɵtextInterpolate1","ɵɵpipeBind3","type","SumsProductTypeComponent_ng_container_0_ng_container_7_Template","ɵɵelementContainerStart","ɵɵtemplate","ɵɵelementContainerEnd","ɵɵpropertyInterpolate","SumsProductTypeComponent_ng_container_0_tr_8_Template","SumsProductTypeComponent_ng_container_0_tr_9_Template","SumsProductTypeComponent_ng_container_0_Template","ɵɵi18n","ctx_r0","ɵɵi18nExp","title","ɵɵi18nApply","ɵɵproperty","sumDataSource","sumClumensshow","sumClumensTable","SumsProductTypeComponent","constructor","sumCloumns","mainDetailsSource","value","dataSource","length","nest","seq","keys","first","rest","slice","valu","tempTable","newSumLine","Object","forEach","newLine","sum","diveder","numChecks","val","temp","filter","f","undefined","reduce","b","c","push","Set","newCloumn","aLine","ɵfac","SumsProductTypeComponent_Factory","t","ɵcmp","ɵɵdefineComponent","selectors","inputs","decls","vars","consts","i18n_0","ngI18nClosureMode","MSG_EXTERNAL_2999396308623228810$$SRC_APP_REPORTS_SUM_PRODUCT_TYPE_COMPONENT_TS__1","goog","getMsg","template","SumsProductTypeComponent_Template","directives","NgIf","MatTable","MatColumnDef","MatHeaderCellDef","MatCellDef","NgForOf","MatHeaderRowDef","MatRowDef","MatHeaderCell","MatCell","MatHeaderRow","MatRow","pipes","TableCellPipe","encapsulation"],"mappings":"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","sourcesContent":["import { groupBy, mapValues, cloneDeep } from 'lodash-es';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@angular/common\";\r\nimport * as i2 from \"@angular/material/table\";\r\nimport * as i3 from \"../service/table-cell.pipe\";\r\nfunction SumsProductTypeComponent_ng_container_0_th_5_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelement(0, \"th\", 10);\r\n} }\r\nfunction SumsProductTypeComponent_ng_container_0_td_6_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"td\", 11);\r\n    i0.ɵɵtext(1);\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const element_r6 = ctx.$implicit;\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵtextInterpolate(element_r6.key);\r\n} }\r\nfunction SumsProductTypeComponent_ng_container_0_ng_container_7_th_1_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"th\", 10);\r\n    i0.ɵɵelementStart(1, \"h3\");\r\n    i0.ɵɵtext(2);\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const column_r7 = i0.ɵɵnextContext().$implicit;\r\n    i0.ɵɵadvance(2);\r\n    i0.ɵɵtextInterpolate(column_r7);\r\n} }\r\nfunction SumsProductTypeComponent_ng_container_0_ng_container_7_td_2_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"td\", 11);\r\n    i0.ɵɵtext(1);\r\n    i0.ɵɵpipe(2, \"tableCellPipe\");\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const element_r11 = ctx.$implicit;\r\n    const column_r7 = i0.ɵɵnextContext().$implicit;\r\n    const ctx_r9 = i0.ɵɵnextContext(2);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind3(2, 1, element_r11[column_r7], ctx_r9.type, null), \" \");\r\n} }\r\nfunction SumsProductTypeComponent_ng_container_0_ng_container_7_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementContainerStart(0, 12);\r\n    i0.ɵɵtemplate(1, SumsProductTypeComponent_ng_container_0_ng_container_7_th_1_Template, 3, 1, \"th\", 5);\r\n    i0.ɵɵtemplate(2, SumsProductTypeComponent_ng_container_0_ng_container_7_td_2_Template, 3, 5, \"td\", 6);\r\n    i0.ɵɵelementContainerEnd();\r\n} if (rf & 2) {\r\n    const column_r7 = ctx.$implicit;\r\n    i0.ɵɵpropertyInterpolate(\"matColumnDef\", column_r7);\r\n} }\r\nfunction SumsProductTypeComponent_ng_container_0_tr_8_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelement(0, \"tr\", 13);\r\n} }\r\nfunction SumsProductTypeComponent_ng_container_0_tr_9_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelement(0, \"tr\", 14);\r\n} }\r\nfunction SumsProductTypeComponent_ng_container_0_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementContainerStart(0);\r\n    i0.ɵɵelementStart(1, \"h2\", 1);\r\n    i0.ɵɵi18n(2, 2);\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementStart(3, \"table\", 3);\r\n    i0.ɵɵelementContainerStart(4, 4);\r\n    i0.ɵɵtemplate(5, SumsProductTypeComponent_ng_container_0_th_5_Template, 1, 0, \"th\", 5);\r\n    i0.ɵɵtemplate(6, SumsProductTypeComponent_ng_container_0_td_6_Template, 2, 1, \"td\", 6);\r\n    i0.ɵɵelementContainerEnd();\r\n    i0.ɵɵtemplate(7, SumsProductTypeComponent_ng_container_0_ng_container_7_Template, 3, 1, \"ng-container\", 7);\r\n    i0.ɵɵtemplate(8, SumsProductTypeComponent_ng_container_0_tr_8_Template, 1, 0, \"tr\", 8);\r\n    i0.ɵɵtemplate(9, SumsProductTypeComponent_ng_container_0_tr_9_Template, 1, 0, \"tr\", 9);\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementContainerEnd();\r\n} if (rf & 2) {\r\n    const ctx_r0 = i0.ɵɵnextContext();\r\n    i0.ɵɵadvance(2);\r\n    i0.ɵɵi18nExp(ctx_r0.title);\r\n    i0.ɵɵi18nApply(2);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"dataSource\", ctx_r0.sumDataSource);\r\n    i0.ɵɵadvance(4);\r\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.sumClumensshow);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"matHeaderRowDef\", ctx_r0.sumClumensTable);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"matRowDefColumns\", ctx_r0.sumClumensTable);\r\n} }\r\nexport class SumsProductTypeComponent {\r\n    constructor() {\r\n        this.sumDataSource = [];\r\n        this.sumCloumns = [];\r\n    }\r\n    set mainDetailsSource(value) {\r\n        if (value) {\r\n            this.dataSource = cloneDeep(value[0]);\r\n            this.sumCloumns = value[1];\r\n            if (this.sumCloumns.length) {\r\n                this.sumDataSource = [];\r\n                var nest = function (seq, keys) {\r\n                    if (!keys.length)\r\n                        return seq;\r\n                    var first = keys[0];\r\n                    var rest = keys.slice(1);\r\n                    return mapValues(groupBy(seq, first), function (valu) {\r\n                        return nest(valu, rest);\r\n                    });\r\n                };\r\n                const tempTable = nest(this.dataSource, this.sumCloumns);\r\n                this.sumClumensTable = ['key'];\r\n                var newSumLine = { key: $localize `Total` };\r\n                Object.keys(tempTable).forEach(key => {\r\n                    var newLine = {};\r\n                    var sum = 0;\r\n                    var diveder = 0;\r\n                    var numChecks = 0;\r\n                    Object.keys(tempTable[key]).forEach(val => {\r\n                        var temp = tempTable[key][val].filter(f => f[value[2]] !== null && f[value[2]] !== undefined);\r\n                        if (temp.length) {\r\n                            newLine[val] = (temp.reduce((b, c) => +b + +c[value[2]], 0));\r\n                            this.sumClumensTable.push(val);\r\n                            sum += newLine[val];\r\n                            diveder++;\r\n                            numChecks += temp.length;\r\n                            newSumLine[val] = newSumLine[val] ? newSumLine[val] + 1 : 1;\r\n                        }\r\n                    });\r\n                    if (numChecks) {\r\n                        newLine['key'] = (key !== 'null') ? key + ' (' + numChecks + ')' : 'other (' + numChecks + ')';\r\n                        newLine[$localize `Total`] = sum;\r\n                        this.sumDataSource.push(newLine);\r\n                    }\r\n                });\r\n                this.sumClumensTable = [...new Set(this.sumClumensTable)];\r\n                this.sumClumensTable.push($localize `Total`);\r\n                this.sumClumensTable.forEach(newCloumn => {\r\n                    if (newCloumn === $localize `Total`) {\r\n                        var sum = 0;\r\n                        this.sumDataSource.forEach(aLine => {\r\n                            if (aLine[newCloumn]) {\r\n                                sum += aLine[newCloumn];\r\n                            }\r\n                        });\r\n                        newSumLine[newCloumn] = sum;\r\n                    }\r\n                    else if (newCloumn !== 'key') {\r\n                        var sum = 0;\r\n                        this.sumDataSource.forEach(aLine => {\r\n                            sum += aLine[newCloumn] ? aLine[newCloumn] : 0;\r\n                        });\r\n                        newSumLine[newCloumn] = sum;\r\n                    }\r\n                });\r\n                this.sumDataSource.push(newSumLine);\r\n                this.sumClumensshow = this.sumClumensTable.slice(1);\r\n            }\r\n        }\r\n    }\r\n}\r\nSumsProductTypeComponent.ɵfac = function SumsProductTypeComponent_Factory(t) { return new (t || SumsProductTypeComponent)(); };\r\nSumsProductTypeComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: SumsProductTypeComponent, selectors: [[\"sums-product-type\"]], inputs: { title: \"title\", type: \"type\", mainDetailsSource: \"mainDetailsSource\" }, decls: 1, vars: 1, consts: function () { let i18n_0; if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\r\n        const MSG_EXTERNAL_2999396308623228810$$SRC_APP_REPORTS_SUM_PRODUCT_TYPE_COMPONENT_TS__1 = goog.getMsg(\"{$interpolation}\", { \"interpolation\": \"\\uFFFD0\\uFFFD\" });\r\n        i18n_0 = MSG_EXTERNAL_2999396308623228810$$SRC_APP_REPORTS_SUM_PRODUCT_TYPE_COMPONENT_TS__1;\r\n    }\r\n    else {\r\n        i18n_0 = $localize `:␟045ed332fbb2645493d6955677247db0d1134c2d␟2999396308623228810:${\"\\uFFFD0\\uFFFD\"}:INTERPOLATION:`;\r\n    } return [[4, \"ngIf\"], [2, \"text-align\", \"center\"], i18n_0, [\"mat-table\", \"\", 2, \"text-align\", \"center !important\", 3, \"dataSource\"], [\"matColumnDef\", \"key\"], [\"mat-header-cell\", \"\", 4, \"matHeaderCellDef\"], [\"mat-cell\", \"\", 4, \"matCellDef\"], [3, \"matColumnDef\", 4, \"ngFor\", \"ngForOf\"], [\"mat-header-row\", \"\", 4, \"matHeaderRowDef\"], [\"mat-row\", \"\", 4, \"matRowDef\", \"matRowDefColumns\"], [\"mat-header-cell\", \"\"], [\"mat-cell\", \"\"], [3, \"matColumnDef\"], [\"mat-header-row\", \"\"], [\"mat-row\", \"\"]]; }, template: function SumsProductTypeComponent_Template(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵtemplate(0, SumsProductTypeComponent_ng_container_0_Template, 10, 5, \"ng-container\", 0);\r\n    } if (rf & 2) {\r\n        i0.ɵɵproperty(\"ngIf\", ctx.sumClumensshow.length > 1);\r\n    } }, directives: [i1.NgIf, i2.MatTable, i2.MatColumnDef, i2.MatHeaderCellDef, i2.MatCellDef, i1.NgForOf, i2.MatHeaderRowDef, i2.MatRowDef, i2.MatHeaderCell, i2.MatCell, i2.MatHeaderRow, i2.MatRow], pipes: [i3.TableCellPipe], encapsulation: 2 });\r\n"]},"metadata":{},"sourceType":"module"}