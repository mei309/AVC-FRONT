{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport { NavigationEnd } from '@angular/router';\nimport { take } from 'rxjs/operators';\nimport { cloneDeep } from 'lodash-es';\nimport { InventoryDetailsDialogComponent } from './inventory-details-dialog.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./inventory.service\";\nimport * as i2 from \"../genral.service\";\nimport * as i3 from \"@angular/material/dialog\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"../components/dynamic-form/dynamic-form.component\";\n\nfunction MaterialUsageComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"dynamic-form\", 1);\n    i0.ɵɵlistener(\"submitForm\", function MaterialUsageComponent_div_0_Template_dynamic_form_submitForm_1_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return ctx_r1.submit($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"fields\", ctx_r0.regConfigUse)(\"putData\", ctx_r0.dataSource);\n  }\n}\n\nexport class MaterialUsageComponent {\n  constructor(cdRef, localService, genral, dialog, _Activatedroute, router) {\n    this.cdRef = cdRef;\n    this.localService = localService;\n    this.genral = genral;\n    this.dialog = dialog;\n    this._Activatedroute = _Activatedroute;\n    this.router = router;\n    this.isFormAvailable = false;\n  }\n\n  submit(value) {\n    var arr = [];\n\n    if (value['materialUsed']) {\n      value['materialUsed'].forEach(element => {\n        element['storageMoves'] = element['storageMoves'].filter(amou => amou.numberUsedUnits);\n        element['groupName'] = 'meterialUsedPos';\n      });\n      value['materialUsed'] = value['materialUsed'].filter(amou => amou.storageMoves.length);\n      arr = arr.concat(value['materialUsed']);\n      delete value['materialUsed'];\n    }\n\n    value['storageMovesGroups'] = arr;\n    this.localService.addEditMaterialUse(value, this.dataSource ? false : true).pipe(take(1)).subscribe(val => {\n      const dialogRef = this.dialog.open(InventoryDetailsDialogComponent, {\n        width: '80%',\n        data: {\n          inventoryItem: cloneDeep(val),\n          fromNew: true,\n          type: \"Material usage\"\n        }\n      });\n      dialogRef.afterClosed().subscribe(result => {\n        if (result === \"Edit\") {\n          this.isFormAvailable = false;\n          this.dataSource = null;\n          this.cdRef.detectChanges();\n          this.localService.getStroageUse(val['id']).pipe(take(1)).subscribe(val1 => {\n            var _a;\n\n            (_a = val1['storageMovesGroups']) === null || _a === void 0 ? void 0 : _a.forEach(em => {\n              var _a;\n\n              (_a = em['storageMoves']) === null || _a === void 0 ? void 0 : _a.forEach(el => {\n                el['storage']['numberAvailableUnits'] = el['numberAvailableUnits'];\n              });\n            });\n            val1['materialUsed'] = val1['storageMovesGroups'];\n            delete val1['storageMovesGroups'];\n            this.dataSource = val1;\n            this.isFormAvailable = true;\n          });\n        } else {\n          this.router.navigate(['../Reports', {\n            number: 0\n          }], {\n            relativeTo: this._Activatedroute\n          });\n        }\n      });\n    });\n  }\n\n  ngOnInit() {\n    this._Activatedroute.paramMap.pipe(take(1)).subscribe(params => {\n      if (params.get('id')) {\n        this.localService.getStroageUse(+params.get('id')).pipe(take(1)).subscribe(val => {\n          var _a;\n\n          (_a = val['storageMovesGroups']) === null || _a === void 0 ? void 0 : _a.forEach(em => {\n            var _a;\n\n            (_a = em['storageMoves']) === null || _a === void 0 ? void 0 : _a.forEach(el => {\n              el['storage']['numberAvailableUnits'] = el['numberAvailableUnits'];\n            });\n          });\n          val['materialUsed'] = val['storageMovesGroups'];\n          delete val['storageMovesGroups'];\n          this.dataSource = val;\n          this.isFormAvailable = true;\n        });\n      } else {\n        this.isFormAvailable = true;\n      }\n    });\n\n    this.setRegConfig();\n    this.navigationSubscription = this.router.events.subscribe(e => {\n      // If it is a NavigationEnd event re-initalise the component\n      if (e instanceof NavigationEnd) {\n        this.isFormAvailable = false;\n        this.dataSource = null;\n        this.cdRef.detectChanges();\n        this.isFormAvailable = true;\n      }\n    });\n  }\n\n  setRegConfig() {\n    this.regConfigUse = [{\n      type: 'date',\n      label: \"Date\",\n      value: 'timeNow',\n      name: 'recordedTime',\n      options: 'withTime',\n      validations: [{\n        name: 'required',\n        validator: Validators.required,\n        message: \"Date Required\"\n      }]\n    }, {\n      type: 'select',\n      label: \"Production line\",\n      value: 'firstVal',\n      name: 'productionLine',\n      options: this.genral.getProductionLine('GENERAL_USE'),\n      validations: [{\n        name: 'required',\n        validator: Validators.required,\n        message: \"Production line Required\"\n      }]\n    }, {\n      type: 'textarry',\n      label: \"Remarks\",\n      inputType: 'text',\n      name: 'remarks'\n    }, {\n      type: 'bigexpand',\n      name: 'materialUsed',\n      label: \"Material used\",\n      options: 'aloneNoAdd',\n      collections: [{\n        type: 'materialUsage',\n        // label: 'Transfer from',\n        name: 'storageMoves',\n        collections: [{\n          type: 'selectgroup',\n          inputType: 'supplierName',\n          // options: this.localService.getAllPosRoastPacked(),\n          disable: true,\n          collections: [{\n            type: 'select',\n            label: \"Supplier\"\n          }, {\n            type: 'select',\n            label: \"#PO\",\n            name: 'itemPo',\n            collections: 'somewhere'\n          }]\n        }, {\n          type: 'select',\n          label: \"Item\",\n          name: 'item',\n          disable: true\n        }, {\n          type: 'date',\n          label: \"Process date\",\n          name: 'itemProcessDate',\n          disable: true\n        }, {\n          type: 'input',\n          label: \"Weight unit\",\n          name: 'measureUnit',\n          disable: true\n        }, {\n          type: 'bignotexpand',\n          name: 'storage',\n          collections: [{\n            type: 'input',\n            label: \"Number of units\",\n            name: 'numberUnits',\n            disable: true\n          }, {\n            type: 'input',\n            name: 'unitAmount',\n            label: \"Unit weight\",\n            disable: true //     collections: [\n            //         {\n            //             type: 'input',\n            //             label: 'Unit weight',\n            //             name: 'amount',\n            //         },\n            //         {\n            //             type: 'select',\n            //             label: 'Weight unit',\n            //             name: 'measureUnit',\n            //         },\n            //     ]\n\n          }, {\n            type: 'select',\n            label: \"Warehouse location\",\n            name: 'warehouseLocation',\n            disable: true\n          }, {\n            type: 'input',\n            label: \"Number available units\",\n            name: 'numberAvailableUnits',\n            disable: true\n          }]\n        }]\n      }]\n    }, {\n      type: 'button',\n      label: \"Submit\",\n      name: 'submit'\n    }];\n  }\n\n  ngOnDestroy() {\n    if (this.navigationSubscription) {\n      this.navigationSubscription.unsubscribe();\n    }\n  }\n\n}\n\nMaterialUsageComponent.ɵfac = function MaterialUsageComponent_Factory(t) {\n  return new (t || MaterialUsageComponent)(i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.InventoryService), i0.ɵɵdirectiveInject(i2.Genral), i0.ɵɵdirectiveInject(i3.MatDialog), i0.ɵɵdirectiveInject(i4.ActivatedRoute), i0.ɵɵdirectiveInject(i4.Router));\n};\n\nMaterialUsageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: MaterialUsageComponent,\n  selectors: [[\"material-use\"]],\n  decls: 1,\n  vars: 1,\n  consts: function () {\n    let i18n_0;\n\n    if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n      const MSG_EXTERNAL_4256557918732011890$$SRC_APP_INVENTORY_MATERIAL_USE_COMPONENT_TS__1 = goog.getMsg(\"Material use\");\n      i18n_0 = MSG_EXTERNAL_4256557918732011890$$SRC_APP_INVENTORY_MATERIAL_USE_COMPONENT_TS__1;\n    } else {\n      i18n_0 = \"Material use\";\n    }\n\n    return [[4, \"ngIf\"], [\"mainLabel\", i18n_0, 3, \"fields\", \"putData\", \"submitForm\"]];\n  },\n  template: function MaterialUsageComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, MaterialUsageComponent_div_0_Template, 2, 2, \"div\", 0);\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.isFormAvailable);\n    }\n  },\n  directives: [i5.NgIf, i6.DynamicFormComponent],\n  encapsulation: 2\n});","map":{"version":3,"sources":["C:/Users/isral/OneDrive/Documents/AVC-FRONT/src/app/inventory/material-use.component.ts"],"names":["Validators","NavigationEnd","take","cloneDeep","InventoryDetailsDialogComponent","i0","i1","i2","i3","i4","i5","i6","MaterialUsageComponent_div_0_Template","rf","ctx","_r2","ɵɵgetCurrentView","ɵɵelementStart","ɵɵlistener","MaterialUsageComponent_div_0_Template_dynamic_form_submitForm_1_listener","$event","ɵɵrestoreView","ctx_r1","ɵɵnextContext","submit","ɵɵelementEnd","ctx_r0","ɵɵadvance","ɵɵproperty","regConfigUse","dataSource","MaterialUsageComponent","constructor","cdRef","localService","genral","dialog","_Activatedroute","router","isFormAvailable","value","arr","forEach","element","filter","amou","numberUsedUnits","storageMoves","length","concat","addEditMaterialUse","pipe","subscribe","val","dialogRef","open","width","data","inventoryItem","fromNew","type","afterClosed","result","detectChanges","getStroageUse","val1","_a","em","el","navigate","number","relativeTo","ngOnInit","paramMap","params","get","setRegConfig","navigationSubscription","events","e","label","name","options","validations","validator","required","message","getProductionLine","inputType","collections","disable","ngOnDestroy","unsubscribe","ɵfac","MaterialUsageComponent_Factory","t","ɵɵdirectiveInject","ChangeDetectorRef","InventoryService","Genral","MatDialog","ActivatedRoute","Router","ɵcmp","ɵɵdefineComponent","selectors","decls","vars","consts","i18n_0","ngI18nClosureMode","MSG_EXTERNAL_4256557918732011890$$SRC_APP_INVENTORY_MATERIAL_USE_COMPONENT_TS__1","goog","getMsg","template","MaterialUsageComponent_Template","ɵɵtemplate","directives","NgIf","DynamicFormComponent","encapsulation"],"mappings":"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","sourcesContent":["import { Validators } from '@angular/forms';\r\nimport { NavigationEnd } from '@angular/router';\r\nimport { take } from 'rxjs/operators';\r\nimport { cloneDeep } from 'lodash-es';\r\nimport { InventoryDetailsDialogComponent } from './inventory-details-dialog.component';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"./inventory.service\";\r\nimport * as i2 from \"../genral.service\";\r\nimport * as i3 from \"@angular/material/dialog\";\r\nimport * as i4 from \"@angular/router\";\r\nimport * as i5 from \"@angular/common\";\r\nimport * as i6 from \"../components/dynamic-form/dynamic-form.component\";\r\nfunction MaterialUsageComponent_div_0_Template(rf, ctx) { if (rf & 1) {\r\n    const _r2 = i0.ɵɵgetCurrentView();\r\n    i0.ɵɵelementStart(0, \"div\");\r\n    i0.ɵɵelementStart(1, \"dynamic-form\", 1);\r\n    i0.ɵɵlistener(\"submitForm\", function MaterialUsageComponent_div_0_Template_dynamic_form_submitForm_1_listener($event) { i0.ɵɵrestoreView(_r2); const ctx_r1 = i0.ɵɵnextContext(); return ctx_r1.submit($event); });\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const ctx_r0 = i0.ɵɵnextContext();\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"fields\", ctx_r0.regConfigUse)(\"putData\", ctx_r0.dataSource);\r\n} }\r\nexport class MaterialUsageComponent {\r\n    constructor(cdRef, localService, genral, dialog, _Activatedroute, router) {\r\n        this.cdRef = cdRef;\r\n        this.localService = localService;\r\n        this.genral = genral;\r\n        this.dialog = dialog;\r\n        this._Activatedroute = _Activatedroute;\r\n        this.router = router;\r\n        this.isFormAvailable = false;\r\n    }\r\n    submit(value) {\r\n        var arr = [];\r\n        if (value['materialUsed']) {\r\n            value['materialUsed'].forEach(element => {\r\n                element['storageMoves'] = element['storageMoves'].filter(amou => amou.numberUsedUnits);\r\n                element['groupName'] = 'meterialUsedPos';\r\n            });\r\n            value['materialUsed'] = value['materialUsed'].filter(amou => amou.storageMoves.length);\r\n            arr = arr.concat(value['materialUsed']);\r\n            delete value['materialUsed'];\r\n        }\r\n        value['storageMovesGroups'] = arr;\r\n        this.localService.addEditMaterialUse(value, this.dataSource ? false : true).pipe(take(1)).subscribe(val => {\r\n            const dialogRef = this.dialog.open(InventoryDetailsDialogComponent, {\r\n                width: '80%',\r\n                data: { inventoryItem: cloneDeep(val), fromNew: true, type: $localize `Material usage` }\r\n            });\r\n            dialogRef.afterClosed().subscribe(result => {\r\n                if (result === $localize `Edit`) {\r\n                    this.isFormAvailable = false;\r\n                    this.dataSource = null;\r\n                    this.cdRef.detectChanges();\r\n                    this.localService.getStroageUse(val['id']).pipe(take(1)).subscribe(val1 => {\r\n                        var _a;\r\n                        (_a = val1['storageMovesGroups']) === null || _a === void 0 ? void 0 : _a.forEach(em => {\r\n                            var _a;\r\n                            (_a = em['storageMoves']) === null || _a === void 0 ? void 0 : _a.forEach(el => {\r\n                                el['storage']['numberAvailableUnits'] = el['numberAvailableUnits'];\r\n                            });\r\n                        });\r\n                        val1['materialUsed'] = val1['storageMovesGroups'];\r\n                        delete val1['storageMovesGroups'];\r\n                        this.dataSource = val1;\r\n                        this.isFormAvailable = true;\r\n                    });\r\n                }\r\n                else {\r\n                    this.router.navigate(['../Reports', { number: 0 }], { relativeTo: this._Activatedroute });\r\n                }\r\n            });\r\n        });\r\n    }\r\n    ngOnInit() {\r\n        this._Activatedroute.paramMap.pipe(take(1)).subscribe(params => {\r\n            if (params.get('id')) {\r\n                this.localService.getStroageUse(+params.get('id')).pipe(take(1)).subscribe(val => {\r\n                    var _a;\r\n                    (_a = val['storageMovesGroups']) === null || _a === void 0 ? void 0 : _a.forEach(em => {\r\n                        var _a;\r\n                        (_a = em['storageMoves']) === null || _a === void 0 ? void 0 : _a.forEach(el => {\r\n                            el['storage']['numberAvailableUnits'] = el['numberAvailableUnits'];\r\n                        });\r\n                    });\r\n                    val['materialUsed'] = val['storageMovesGroups'];\r\n                    delete val['storageMovesGroups'];\r\n                    this.dataSource = val;\r\n                    this.isFormAvailable = true;\r\n                });\r\n            }\r\n            else {\r\n                this.isFormAvailable = true;\r\n            }\r\n        });\r\n        this.setRegConfig();\r\n        this.navigationSubscription = this.router.events.subscribe((e) => {\r\n            // If it is a NavigationEnd event re-initalise the component\r\n            if (e instanceof NavigationEnd) {\r\n                this.isFormAvailable = false;\r\n                this.dataSource = null;\r\n                this.cdRef.detectChanges();\r\n                this.isFormAvailable = true;\r\n            }\r\n        });\r\n    }\r\n    setRegConfig() {\r\n        this.regConfigUse = [\r\n            {\r\n                type: 'date',\r\n                label: $localize `Date`,\r\n                value: 'timeNow',\r\n                name: 'recordedTime',\r\n                options: 'withTime',\r\n                validations: [\r\n                    {\r\n                        name: 'required',\r\n                        validator: Validators.required,\r\n                        message: $localize `Date Required`,\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                type: 'select',\r\n                label: $localize `Production line`,\r\n                value: 'firstVal',\r\n                name: 'productionLine',\r\n                options: this.genral.getProductionLine('GENERAL_USE'),\r\n                validations: [\r\n                    {\r\n                        name: 'required',\r\n                        validator: Validators.required,\r\n                        message: $localize `Production line Required`,\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                type: 'textarry',\r\n                label: $localize `Remarks`,\r\n                inputType: 'text',\r\n                name: 'remarks',\r\n            },\r\n            {\r\n                type: 'bigexpand',\r\n                name: 'materialUsed',\r\n                label: $localize `Material used`,\r\n                options: 'aloneNoAdd',\r\n                collections: [\r\n                    {\r\n                        type: 'materialUsage',\r\n                        // label: 'Transfer from',\r\n                        name: 'storageMoves',\r\n                        collections: [\r\n                            {\r\n                                type: 'selectgroup',\r\n                                inputType: 'supplierName',\r\n                                // options: this.localService.getAllPosRoastPacked(),\r\n                                disable: true,\r\n                                collections: [\r\n                                    {\r\n                                        type: 'select',\r\n                                        label: $localize `Supplier`,\r\n                                    },\r\n                                    {\r\n                                        type: 'select',\r\n                                        label: $localize `#PO`,\r\n                                        name: 'itemPo',\r\n                                        collections: 'somewhere',\r\n                                    },\r\n                                ]\r\n                            },\r\n                            {\r\n                                type: 'select',\r\n                                label: $localize `Item`,\r\n                                name: 'item',\r\n                                disable: true,\r\n                            },\r\n                            {\r\n                                type: 'date',\r\n                                label: $localize `Process date`,\r\n                                name: 'itemProcessDate',\r\n                                disable: true,\r\n                            },\r\n                            {\r\n                                type: 'input',\r\n                                label: $localize `Weight unit`,\r\n                                name: 'measureUnit',\r\n                                disable: true,\r\n                            },\r\n                            {\r\n                                type: 'bignotexpand',\r\n                                name: 'storage',\r\n                                collections: [\r\n                                    {\r\n                                        type: 'input',\r\n                                        label: $localize `Number of units`,\r\n                                        name: 'numberUnits',\r\n                                        disable: true,\r\n                                    },\r\n                                    {\r\n                                        type: 'input',\r\n                                        name: 'unitAmount',\r\n                                        label: $localize `Unit weight`,\r\n                                        disable: true,\r\n                                        //     collections: [\r\n                                        //         {\r\n                                        //             type: 'input',\r\n                                        //             label: 'Unit weight',\r\n                                        //             name: 'amount',\r\n                                        //         },\r\n                                        //         {\r\n                                        //             type: 'select',\r\n                                        //             label: 'Weight unit',\r\n                                        //             name: 'measureUnit',\r\n                                        //         },\r\n                                        //     ]\r\n                                    },\r\n                                    {\r\n                                        type: 'select',\r\n                                        label: $localize `Warehouse location`,\r\n                                        name: 'warehouseLocation',\r\n                                        disable: true,\r\n                                    },\r\n                                    {\r\n                                        type: 'input',\r\n                                        label: $localize `Number available units`,\r\n                                        name: 'numberAvailableUnits',\r\n                                        disable: true,\r\n                                    },\r\n                                ]\r\n                            },\r\n                        ],\r\n                    },\r\n                ]\r\n            },\r\n            {\r\n                type: 'button',\r\n                label: $localize `Submit`,\r\n                name: 'submit',\r\n            }\r\n        ];\r\n    }\r\n    ngOnDestroy() {\r\n        if (this.navigationSubscription) {\r\n            this.navigationSubscription.unsubscribe();\r\n        }\r\n    }\r\n}\r\nMaterialUsageComponent.ɵfac = function MaterialUsageComponent_Factory(t) { return new (t || MaterialUsageComponent)(i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.InventoryService), i0.ɵɵdirectiveInject(i2.Genral), i0.ɵɵdirectiveInject(i3.MatDialog), i0.ɵɵdirectiveInject(i4.ActivatedRoute), i0.ɵɵdirectiveInject(i4.Router)); };\r\nMaterialUsageComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: MaterialUsageComponent, selectors: [[\"material-use\"]], decls: 1, vars: 1, consts: function () { let i18n_0; if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\r\n        const MSG_EXTERNAL_4256557918732011890$$SRC_APP_INVENTORY_MATERIAL_USE_COMPONENT_TS__1 = goog.getMsg(\"Material use\");\r\n        i18n_0 = MSG_EXTERNAL_4256557918732011890$$SRC_APP_INVENTORY_MATERIAL_USE_COMPONENT_TS__1;\r\n    }\r\n    else {\r\n        i18n_0 = $localize `:␟57468c0b61d0caecd7e67b782327d1397fa98d97␟4256557918732011890:Material use`;\r\n    } return [[4, \"ngIf\"], [\"mainLabel\", i18n_0, 3, \"fields\", \"putData\", \"submitForm\"]]; }, template: function MaterialUsageComponent_Template(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵtemplate(0, MaterialUsageComponent_div_0_Template, 2, 2, \"div\", 0);\r\n    } if (rf & 2) {\r\n        i0.ɵɵproperty(\"ngIf\", ctx.isFormAvailable);\r\n    } }, directives: [i5.NgIf, i6.DynamicFormComponent], encapsulation: 2 });\r\n"]},"metadata":{},"sourceType":"module"}