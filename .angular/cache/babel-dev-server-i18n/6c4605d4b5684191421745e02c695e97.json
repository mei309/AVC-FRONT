{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport { NavigationEnd } from '@angular/router';\nimport { distinctUntilChanged, take } from 'rxjs/operators';\nimport { ReplaySubject } from 'rxjs';\nimport { cloneDeep } from 'lodash-es';\nimport { ReceiptDialog } from './receipt-dialog.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"./receipt.service\";\nimport * as i3 from \"../genral.service\";\nimport * as i4 from \"@angular/material/dialog\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"../components/dynamic-field/dynamic-field.directive\";\nimport * as i8 from \"../components/dynamic-form/dynamic-form.component\";\n\nfunction ReceiveGOrder_fieldset_0_ng_container_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainer(0, 5);\n  }\n\n  if (rf & 2) {\n    const field_r3 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"field\", field_r3)(\"group\", ctx_r2.form);\n  }\n}\n\nconst _c2 = function () {\n  return {\n    \"width\": \"90%\"\n  };\n};\n\nfunction ReceiveGOrder_fieldset_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"fieldset\", 2);\n    i0.ɵɵelementStart(1, \"legend\");\n    i0.ɵɵelementStart(2, \"h1\");\n    i0.ɵɵi18n(3, 3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, ReceiveGOrder_fieldset_0_ng_container_4_Template, 1, 2, \"ng-container\", 4);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction0(2, _c2));\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.poConfig);\n  }\n}\n\nfunction ReceiveGOrder_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"dynamic-form\", 6);\n    i0.ɵɵlistener(\"submitForm\", function ReceiveGOrder_div_1_Template_dynamic_form_submitForm_1_listener($event) {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.submit($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"fields\", ctx_r1.regConfig)(\"putData\", ctx_r1.putData);\n  }\n}\n\nexport class ReceiveGOrder {\n  constructor(router, _Activatedroute, cdRef, localService, genral, dialog, fb) {\n    this.router = router;\n    this._Activatedroute = _Activatedroute;\n    this.cdRef = cdRef;\n    this.localService = localService;\n    this.genral = genral;\n    this.dialog = dialog;\n    this.fb = fb;\n    this.OrderdItems = new ReplaySubject();\n    this.putData = null;\n    this.isDataAvailable = false;\n    this.isFirstDataAvailable = false;\n    this.fromNew = true;\n  }\n\n  ngOnInit() {\n    this._Activatedroute.paramMap.pipe(take(1)).subscribe(params => {\n      if (params.get('poCode')) {\n        var po = +params.get('poCode');\n\n        if (params.get('id')) {\n          this.localService.getReceive(+params.get('id')).pipe(take(1)).subscribe(val => {\n            this.setOrderItemsEdit(po, val);\n          });\n          this.fromNew = false;\n        } else {\n          this.setUpOrderItems(po);\n        }\n      } else {\n        this.setBeginChoose();\n      }\n    });\n\n    this.navigationSubscription = this.router.events.subscribe(e => {\n      // If it is a NavigationEnd event re-initalise the component\n      if (e instanceof NavigationEnd) {\n        this.isDataAvailable = false;\n        this.isFirstDataAvailable = false;\n        this.putData = null;\n        this.poID = null;\n\n        if (this.poConfig) {\n          this.form.get('poCode').setValue(null);\n        } else {\n          this.setBeginChoose();\n        }\n\n        this.cdRef.detectChanges();\n        this.isFirstDataAvailable = true;\n      }\n    });\n  }\n\n  setBeginChoose() {\n    this.form = this.fb.group({});\n    this.form.addControl('poCode', this.fb.control(''));\n    this.form.get('poCode').valueChanges.pipe(distinctUntilChanged()).subscribe(selectedValue => {\n      if (selectedValue && selectedValue.hasOwnProperty('id') && this.poID != selectedValue['id']) {\n        this.setUpOrderItems(selectedValue['id']);\n        this.isFirstDataAvailable = false;\n        this.poID = selectedValue['id'];\n      }\n    });\n    this.isFirstDataAvailable = true;\n    this.poConfig = [{\n      type: 'selectgroup',\n      inputType: 'supplierName',\n      options: this.localService.getPoGeneralCodesOpen(),\n      collections: [{\n        type: 'select',\n        label: \"Supplier\"\n      }, {\n        type: 'select',\n        label: \"#PO\",\n        name: 'poCode',\n        collections: 'somewhere'\n      }]\n    }];\n  }\n\n  setUpOrderItems(idnum) {\n    this.localService.getOrderPO(idnum).pipe(take(1)).subscribe(val => {\n      this.OrderdItems.next(val['orderItems']);\n      this.putData = {\n        poCode: val['poCode']\n      };\n      this.isDataAvailable = true;\n    });\n    this.setUpRegConfig();\n  }\n\n  setOrderItemsEdit(ponum, val) {\n    if (val['referencedOrder']) {\n      this.localService.getOrder(val['referencedOrder']).pipe(take(1)).subscribe(value => {\n        this.OrderdItems.next(value ? value['orderItems'] : []);\n        this.setUpEditRecieving(value ? value['orderItems'] : [], val);\n      });\n    } else {\n      this.localService.getOrderPO(ponum).pipe(take(1)).subscribe(value => {\n        this.OrderdItems.next(value ? value['orderItems'] : []);\n        this.setUpEditRecieving(value ? value['orderItems'] : [], val);\n      });\n    }\n  }\n\n  setUpEditRecieving(orderItems, val) {\n    val['receiptItems'].forEach(element => {\n      if (element['orderItem']) {\n        element['orderItem'] = orderItems.find(xx => xx.id === element['orderItem']['id']);\n      }\n    });\n    this.putData = val;\n    this.setUpRegConfig();\n    this.isDataAvailable = true;\n  }\n\n  setUpRegConfig() {\n    this.regConfig = [{\n      type: 'selectgroup',\n      inputType: 'supplierName',\n      disable: true,\n      collections: [{\n        type: 'select',\n        label: \"Supplier\"\n      }, {\n        type: 'select',\n        label: \"#PO\",\n        name: 'poCode'\n      }]\n    }, {\n      type: 'date',\n      label: \"Receiving date\",\n      value: 'timeNow',\n      name: 'recordedTime',\n      options: 'withTime',\n      // disable: disable,\n      validations: [{\n        name: 'required',\n        validator: Validators.required,\n        message: 'Receiving date Required'\n      }]\n    }, {\n      type: 'bigexpand',\n      label: \"Receive product\",\n      name: 'receiptItems',\n      value: 'required',\n      // options: 'aloneNoAdd',\n      collections: [{\n        type: 'selectLine',\n        name: 'orderItem',\n        label: \"Orderd item\",\n        options: this.getOrderdItems(),\n        collections: [{\n          name: 'item',\n          type: 'value'\n        }, {\n          name: 'numberUnits',\n          type: 'value'\n        }]\n      }, {\n        type: 'select',\n        label: \"Item reciving\",\n        name: 'item',\n        collections: 'somewhere',\n        inputType: 'orderItem',\n        options: this.genral.getItemsGeneral()\n      }, {\n        type: 'selectMU',\n        label: \"Weight unit\",\n        name: 'measureUnit'\n      }, {\n        type: 'divider',\n        inputType: 'newlinespace'\n      }, {\n        type: 'bigexpand',\n        label: \"Amounts\",\n        name: 'storageForms',\n        options: 'Inline',\n        collections: [{\n          type: 'input',\n          label: \"Unit amount\",\n          name: 'unitAmount',\n          inputType: 'numeric',\n          options: 3\n        }, {\n          type: 'input',\n          label: \"Number of units\",\n          name: 'numberUnits',\n          inputType: 'numeric',\n          options: 3\n        }, {\n          type: 'select',\n          label: \"Warehouse location\",\n          name: 'warehouseLocation',\n          collections: 'somewhere',\n          options: this.genral.getWearhouses()\n        }, {\n          type: 'divider',\n          inputType: 'divide'\n        }],\n        validations: [// {\n        //     name: 'unitAmount',\n        // },\n        {\n          name: 'numberUnits',\n          message: \"a received storage must have number of bags\"\n        }]\n      }, {\n        type: 'divider',\n        inputType: 'titel',\n        label: \"Invoice amounts\"\n      }, {\n        type: 'inputselect',\n        name: 'receivedOrderUnits',\n        options: 'orderItem',\n        inputType: 'parentnumberUnits',\n        collections: [{\n          type: 'input',\n          label: \"Payable amount\",\n          name: 'amount',\n          inputType: 'numeric',\n          options: 3\n        }, {\n          type: 'select',\n          label: \"Measure unit\",\n          name: 'measureUnit',\n          value: 'LBS',\n          options: this.genral.getMeasureUnit()\n        }]\n      }, {\n        type: 'inputselect',\n        name: 'unitPrice',\n        options: 'orderItem',\n        inputType: 'parentunitPrice',\n        collections: [{\n          type: 'input',\n          label: \"Price per unit\",\n          name: 'amount',\n          inputType: 'numeric',\n          options: 3\n        }, {\n          type: 'select',\n          label: \"Currency\",\n          name: 'currency',\n          options: ['VND', 'USD']\n        }]\n      }, {\n        type: 'divider',\n        inputType: 'divide'\n      }],\n      validations: [{\n        name: 'item',\n        message: \"a received item must have an item, and at least one storage\"\n      }, {\n        name: 'storageForms',\n        validator: [// {\n        //     name: 'unitAmount',\n        // },\n        {\n          name: 'numberUnits'\n        }]\n      }]\n    }, {\n      type: 'button',\n      label: \"Submit\",\n      name: 'submit'\n    }];\n  }\n\n  getOrderdItems() {\n    return this.OrderdItems.asObservable();\n  }\n\n  submit(value) {\n    value['receiptItems'].forEach(element => {\n      if (!element['unitPrice']['amount']) {\n        delete element['unitPrice'];\n      }\n\n      if (!element['receivedOrderUnits']['amount']) {\n        delete element['receivedOrderUnits'];\n      }\n    });\n    this.localService.addEditRecivingGenralOrder(value, this.fromNew).pipe(take(1)).subscribe(val => {\n      const dialogRef = this.dialog.open(ReceiptDialog, {\n        width: '80%',\n        data: {\n          receipt: cloneDeep(val),\n          fromNew: true,\n          type: 'General'\n        }\n      });\n      dialogRef.afterClosed().subscribe(data => {\n        if (data === \"Edit receive\") {\n          this.fromNew = false;\n          this.isDataAvailable = false;\n          this.setOrderItemsEdit(+val['poCode']['id'], val);\n          this.cdRef.detectChanges();\n        } // else if(data === 'Edit order') {\n        //     this.router.navigate(['Main/ordready/NewGenralOrder',{id: val['poCode']['id']}]);\n        // }\n        else {\n          this.router.navigate(['../ReceiveGReports'], {\n            relativeTo: this._Activatedroute\n          });\n        }\n      });\n    });\n  }\n\n  ngOnDestroy() {\n    if (this.navigationSubscription) {\n      this.navigationSubscription.unsubscribe();\n    }\n  }\n\n}\n\nReceiveGOrder.ɵfac = function ReceiveGOrder_Factory(t) {\n  return new (t || ReceiveGOrder)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i2.ReceiptService), i0.ɵɵdirectiveInject(i3.Genral), i0.ɵɵdirectiveInject(i4.MatDialog), i0.ɵɵdirectiveInject(i5.FormBuilder));\n};\n\nReceiveGOrder.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ReceiveGOrder,\n  selectors: [[\"receive-g-order\"]],\n  decls: 2,\n  vars: 2,\n  consts: function () {\n    let i18n_0;\n\n    if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n      const MSG_EXTERNAL_3301100013772706995$$SRC_APP_RECEIPT_RECEIVE_G_ORDER_COMPONENT_TS__1 = goog.getMsg(\"PO# receving\");\n      i18n_0 = MSG_EXTERNAL_3301100013772706995$$SRC_APP_RECEIPT_RECEIVE_G_ORDER_COMPONENT_TS__1;\n    } else {\n      i18n_0 = \"PO# receving\";\n    }\n\n    let i18n_3;\n\n    if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n      const MSG_EXTERNAL_7252885462474989478$$SRC_APP_RECEIPT_RECEIVE_G_ORDER_COMPONENT_TS__4 = goog.getMsg(\"Receving general order\");\n      i18n_3 = MSG_EXTERNAL_7252885462474989478$$SRC_APP_RECEIPT_RECEIVE_G_ORDER_COMPONENT_TS__4;\n    } else {\n      i18n_3 = \"Receving general order\";\n    }\n\n    return [[3, \"ngStyle\", 4, \"ngIf\"], [4, \"ngIf\"], [3, \"ngStyle\"], i18n_0, [\"dynamicField\", \"\", 3, \"field\", \"group\", 4, \"ngFor\", \"ngForOf\"], [\"dynamicField\", \"\", 3, \"field\", \"group\"], [\"mainLabel\", i18n_3, 3, \"fields\", \"putData\", \"submitForm\"]];\n  },\n  template: function ReceiveGOrder_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, ReceiveGOrder_fieldset_0_Template, 5, 3, \"fieldset\", 0);\n      i0.ɵɵtemplate(1, ReceiveGOrder_div_1_Template, 2, 2, \"div\", 1);\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.isFirstDataAvailable);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.isDataAvailable);\n    }\n  },\n  directives: [i6.NgIf, i6.NgStyle, i6.NgForOf, i7.DynamicFieldDirective, i8.DynamicFormComponent],\n  encapsulation: 2\n});","map":{"version":3,"sources":["C:/Users/isral/OneDrive/Documents/AVC-FRONT/src/app/receipt/receive-g-order.component.ts"],"names":["Validators","NavigationEnd","distinctUntilChanged","take","ReplaySubject","cloneDeep","ReceiptDialog","i0","i1","i2","i3","i4","i5","i6","i7","i8","ReceiveGOrder_fieldset_0_ng_container_4_Template","rf","ctx","ɵɵelementContainer","field_r3","$implicit","ctx_r2","ɵɵnextContext","ɵɵproperty","form","_c2","ReceiveGOrder_fieldset_0_Template","ɵɵelementStart","ɵɵi18n","ɵɵelementEnd","ɵɵtemplate","ctx_r0","ɵɵpureFunction0","ɵɵadvance","poConfig","ReceiveGOrder_div_1_Template","_r5","ɵɵgetCurrentView","ɵɵlistener","ReceiveGOrder_div_1_Template_dynamic_form_submitForm_1_listener","$event","ɵɵrestoreView","ctx_r4","submit","ctx_r1","regConfig","putData","ReceiveGOrder","constructor","router","_Activatedroute","cdRef","localService","genral","dialog","fb","OrderdItems","isDataAvailable","isFirstDataAvailable","fromNew","ngOnInit","paramMap","pipe","subscribe","params","get","po","getReceive","val","setOrderItemsEdit","setUpOrderItems","setBeginChoose","navigationSubscription","events","e","poID","setValue","detectChanges","group","addControl","control","valueChanges","selectedValue","hasOwnProperty","type","inputType","options","getPoGeneralCodesOpen","collections","label","name","idnum","getOrderPO","next","poCode","setUpRegConfig","ponum","getOrder","value","setUpEditRecieving","orderItems","forEach","element","find","xx","id","disable","validations","validator","required","message","getOrderdItems","getItemsGeneral","getWearhouses","getMeasureUnit","asObservable","addEditRecivingGenralOrder","dialogRef","open","width","data","receipt","afterClosed","navigate","relativeTo","ngOnDestroy","unsubscribe","ɵfac","ReceiveGOrder_Factory","t","ɵɵdirectiveInject","Router","ActivatedRoute","ChangeDetectorRef","ReceiptService","Genral","MatDialog","FormBuilder","ɵcmp","ɵɵdefineComponent","selectors","decls","vars","consts","i18n_0","ngI18nClosureMode","MSG_EXTERNAL_3301100013772706995$$SRC_APP_RECEIPT_RECEIVE_G_ORDER_COMPONENT_TS__1","goog","getMsg","i18n_3","MSG_EXTERNAL_7252885462474989478$$SRC_APP_RECEIPT_RECEIVE_G_ORDER_COMPONENT_TS__4","template","ReceiveGOrder_Template","directives","NgIf","NgStyle","NgForOf","DynamicFieldDirective","DynamicFormComponent","encapsulation"],"mappings":"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","sourcesContent":["import { Validators } from '@angular/forms';\r\nimport { NavigationEnd } from '@angular/router';\r\nimport { distinctUntilChanged, take } from 'rxjs/operators';\r\nimport { ReplaySubject } from 'rxjs';\r\nimport { cloneDeep } from 'lodash-es';\r\nimport { ReceiptDialog } from './receipt-dialog.component';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@angular/router\";\r\nimport * as i2 from \"./receipt.service\";\r\nimport * as i3 from \"../genral.service\";\r\nimport * as i4 from \"@angular/material/dialog\";\r\nimport * as i5 from \"@angular/forms\";\r\nimport * as i6 from \"@angular/common\";\r\nimport * as i7 from \"../components/dynamic-field/dynamic-field.directive\";\r\nimport * as i8 from \"../components/dynamic-form/dynamic-form.component\";\r\nfunction ReceiveGOrder_fieldset_0_ng_container_4_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementContainer(0, 5);\r\n} if (rf & 2) {\r\n    const field_r3 = ctx.$implicit;\r\n    const ctx_r2 = i0.ɵɵnextContext(2);\r\n    i0.ɵɵproperty(\"field\", field_r3)(\"group\", ctx_r2.form);\r\n} }\r\nconst _c2 = function () { return { \"width\": \"90%\" }; };\r\nfunction ReceiveGOrder_fieldset_0_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"fieldset\", 2);\r\n    i0.ɵɵelementStart(1, \"legend\");\r\n    i0.ɵɵelementStart(2, \"h1\");\r\n    i0.ɵɵi18n(3, 3);\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵtemplate(4, ReceiveGOrder_fieldset_0_ng_container_4_Template, 1, 2, \"ng-container\", 4);\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const ctx_r0 = i0.ɵɵnextContext();\r\n    i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction0(2, _c2));\r\n    i0.ɵɵadvance(4);\r\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.poConfig);\r\n} }\r\nfunction ReceiveGOrder_div_1_Template(rf, ctx) { if (rf & 1) {\r\n    const _r5 = i0.ɵɵgetCurrentView();\r\n    i0.ɵɵelementStart(0, \"div\");\r\n    i0.ɵɵelementStart(1, \"dynamic-form\", 6);\r\n    i0.ɵɵlistener(\"submitForm\", function ReceiveGOrder_div_1_Template_dynamic_form_submitForm_1_listener($event) { i0.ɵɵrestoreView(_r5); const ctx_r4 = i0.ɵɵnextContext(); return ctx_r4.submit($event); });\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const ctx_r1 = i0.ɵɵnextContext();\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"fields\", ctx_r1.regConfig)(\"putData\", ctx_r1.putData);\r\n} }\r\nexport class ReceiveGOrder {\r\n    constructor(router, _Activatedroute, cdRef, localService, genral, dialog, fb) {\r\n        this.router = router;\r\n        this._Activatedroute = _Activatedroute;\r\n        this.cdRef = cdRef;\r\n        this.localService = localService;\r\n        this.genral = genral;\r\n        this.dialog = dialog;\r\n        this.fb = fb;\r\n        this.OrderdItems = new ReplaySubject();\r\n        this.putData = null;\r\n        this.isDataAvailable = false;\r\n        this.isFirstDataAvailable = false;\r\n        this.fromNew = true;\r\n    }\r\n    ngOnInit() {\r\n        this._Activatedroute.paramMap.pipe(take(1)).subscribe(params => {\r\n            if (params.get('poCode')) {\r\n                var po = +params.get('poCode');\r\n                if (params.get('id')) {\r\n                    this.localService.getReceive(+params.get('id')).pipe(take(1)).subscribe(val => {\r\n                        this.setOrderItemsEdit(po, val);\r\n                    });\r\n                    this.fromNew = false;\r\n                }\r\n                else {\r\n                    this.setUpOrderItems(po);\r\n                }\r\n            }\r\n            else {\r\n                this.setBeginChoose();\r\n            }\r\n        });\r\n        this.navigationSubscription = this.router.events.subscribe((e) => {\r\n            // If it is a NavigationEnd event re-initalise the component\r\n            if (e instanceof NavigationEnd) {\r\n                this.isDataAvailable = false;\r\n                this.isFirstDataAvailable = false;\r\n                this.putData = null;\r\n                this.poID = null;\r\n                if (this.poConfig) {\r\n                    this.form.get('poCode').setValue(null);\r\n                }\r\n                else {\r\n                    this.setBeginChoose();\r\n                }\r\n                this.cdRef.detectChanges();\r\n                this.isFirstDataAvailable = true;\r\n            }\r\n        });\r\n    }\r\n    setBeginChoose() {\r\n        this.form = this.fb.group({});\r\n        this.form.addControl('poCode', this.fb.control(''));\r\n        this.form.get('poCode').valueChanges.pipe(distinctUntilChanged()).subscribe(selectedValue => {\r\n            if (selectedValue && selectedValue.hasOwnProperty('id') && this.poID != selectedValue['id']) {\r\n                this.setUpOrderItems(selectedValue['id']);\r\n                this.isFirstDataAvailable = false;\r\n                this.poID = selectedValue['id'];\r\n            }\r\n        });\r\n        this.isFirstDataAvailable = true;\r\n        this.poConfig = [\r\n            {\r\n                type: 'selectgroup',\r\n                inputType: 'supplierName',\r\n                options: this.localService.getPoGeneralCodesOpen(),\r\n                collections: [\r\n                    {\r\n                        type: 'select',\r\n                        label: $localize `Supplier`,\r\n                    },\r\n                    {\r\n                        type: 'select',\r\n                        label: $localize `#PO`,\r\n                        name: 'poCode',\r\n                        collections: 'somewhere',\r\n                    },\r\n                ]\r\n            },\r\n        ];\r\n    }\r\n    setUpOrderItems(idnum) {\r\n        this.localService.getOrderPO(idnum).pipe(take(1)).subscribe(val => {\r\n            this.OrderdItems.next(val['orderItems']);\r\n            this.putData = { poCode: val['poCode'] };\r\n            this.isDataAvailable = true;\r\n        });\r\n        this.setUpRegConfig();\r\n    }\r\n    setOrderItemsEdit(ponum, val) {\r\n        if (val['referencedOrder']) {\r\n            this.localService.getOrder(val['referencedOrder']).pipe(take(1)).subscribe(value => {\r\n                this.OrderdItems.next(value ? value['orderItems'] : []);\r\n                this.setUpEditRecieving(value ? value['orderItems'] : [], val);\r\n            });\r\n        }\r\n        else {\r\n            this.localService.getOrderPO(ponum).pipe(take(1)).subscribe(value => {\r\n                this.OrderdItems.next(value ? value['orderItems'] : []);\r\n                this.setUpEditRecieving(value ? value['orderItems'] : [], val);\r\n            });\r\n        }\r\n    }\r\n    setUpEditRecieving(orderItems, val) {\r\n        val['receiptItems'].forEach(element => {\r\n            if (element['orderItem']) {\r\n                element['orderItem'] = orderItems.find(xx => xx.id === element['orderItem']['id']);\r\n            }\r\n        });\r\n        this.putData = val;\r\n        this.setUpRegConfig();\r\n        this.isDataAvailable = true;\r\n    }\r\n    setUpRegConfig() {\r\n        this.regConfig = [\r\n            {\r\n                type: 'selectgroup',\r\n                inputType: 'supplierName',\r\n                disable: true,\r\n                collections: [\r\n                    {\r\n                        type: 'select',\r\n                        label: $localize `Supplier`,\r\n                    },\r\n                    {\r\n                        type: 'select',\r\n                        label: $localize `#PO`,\r\n                        name: 'poCode',\r\n                    },\r\n                ]\r\n            },\r\n            {\r\n                type: 'date',\r\n                label: $localize `Receiving date`,\r\n                value: 'timeNow',\r\n                name: 'recordedTime',\r\n                options: 'withTime',\r\n                // disable: disable,\r\n                validations: [\r\n                    {\r\n                        name: 'required',\r\n                        validator: Validators.required,\r\n                        message: 'Receiving date Required',\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                type: 'bigexpand',\r\n                label: $localize `Receive product`,\r\n                name: 'receiptItems',\r\n                value: 'required',\r\n                // options: 'aloneNoAdd',\r\n                collections: [\r\n                    {\r\n                        type: 'selectLine',\r\n                        name: 'orderItem',\r\n                        label: $localize `Orderd item`,\r\n                        options: this.getOrderdItems(),\r\n                        collections: [\r\n                            {\r\n                                name: 'item',\r\n                                type: 'value'\r\n                            },\r\n                            {\r\n                                name: 'numberUnits',\r\n                                type: 'value'\r\n                            },\r\n                        ],\r\n                    },\r\n                    {\r\n                        type: 'select',\r\n                        label: $localize `Item reciving`,\r\n                        name: 'item',\r\n                        collections: 'somewhere',\r\n                        inputType: 'orderItem',\r\n                        options: this.genral.getItemsGeneral(),\r\n                    },\r\n                    {\r\n                        type: 'selectMU',\r\n                        label: $localize `Weight unit`,\r\n                        name: 'measureUnit',\r\n                    },\r\n                    {\r\n                        type: 'divider',\r\n                        inputType: 'newlinespace'\r\n                    },\r\n                    {\r\n                        type: 'bigexpand',\r\n                        label: $localize `Amounts`,\r\n                        name: 'storageForms',\r\n                        options: 'Inline',\r\n                        collections: [\r\n                            {\r\n                                type: 'input',\r\n                                label: $localize `Unit amount`,\r\n                                name: 'unitAmount',\r\n                                inputType: 'numeric',\r\n                                options: 3,\r\n                            },\r\n                            {\r\n                                type: 'input',\r\n                                label: $localize `Number of units`,\r\n                                name: 'numberUnits',\r\n                                inputType: 'numeric',\r\n                                options: 3,\r\n                            },\r\n                            {\r\n                                type: 'select',\r\n                                label: $localize `Warehouse location`,\r\n                                name: 'warehouseLocation',\r\n                                collections: 'somewhere',\r\n                                options: this.genral.getWearhouses(),\r\n                            },\r\n                            {\r\n                                type: 'divider',\r\n                                inputType: 'divide'\r\n                            },\r\n                        ],\r\n                        validations: [\r\n                            // {\r\n                            //     name: 'unitAmount',\r\n                            // },\r\n                            {\r\n                                name: 'numberUnits',\r\n                                message: $localize `a received storage must have number of bags`,\r\n                            },\r\n                        ]\r\n                    },\r\n                    {\r\n                        type: 'divider',\r\n                        inputType: 'titel',\r\n                        label: $localize `Invoice amounts`\r\n                    },\r\n                    {\r\n                        type: 'inputselect',\r\n                        name: 'receivedOrderUnits',\r\n                        options: 'orderItem',\r\n                        inputType: 'parentnumberUnits',\r\n                        collections: [\r\n                            {\r\n                                type: 'input',\r\n                                label: $localize `Payable amount`,\r\n                                name: 'amount',\r\n                                inputType: 'numeric',\r\n                                options: 3,\r\n                            },\r\n                            {\r\n                                type: 'select',\r\n                                label: $localize `Measure unit`,\r\n                                name: 'measureUnit',\r\n                                value: 'LBS',\r\n                                options: this.genral.getMeasureUnit(),\r\n                            },\r\n                        ]\r\n                    },\r\n                    {\r\n                        type: 'inputselect',\r\n                        name: 'unitPrice',\r\n                        options: 'orderItem',\r\n                        inputType: 'parentunitPrice',\r\n                        collections: [\r\n                            {\r\n                                type: 'input',\r\n                                label: $localize `Price per unit`,\r\n                                name: 'amount',\r\n                                inputType: 'numeric',\r\n                                options: 3,\r\n                            },\r\n                            {\r\n                                type: 'select',\r\n                                label: $localize `Currency`,\r\n                                name: 'currency',\r\n                                options: ['VND', 'USD'],\r\n                            },\r\n                        ]\r\n                    },\r\n                    {\r\n                        type: 'divider',\r\n                        inputType: 'divide'\r\n                    },\r\n                ],\r\n                validations: [\r\n                    {\r\n                        name: 'item',\r\n                        message: $localize `a received item must have an item, and at least one storage`,\r\n                    },\r\n                    {\r\n                        name: 'storageForms',\r\n                        validator: [\r\n                            // {\r\n                            //     name: 'unitAmount',\r\n                            // },\r\n                            {\r\n                                name: 'numberUnits',\r\n                            },\r\n                        ],\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                type: 'button',\r\n                label: $localize `Submit`,\r\n                name: 'submit',\r\n            }\r\n        ];\r\n    }\r\n    getOrderdItems() {\r\n        return this.OrderdItems.asObservable();\r\n    }\r\n    submit(value) {\r\n        value['receiptItems'].forEach(element => {\r\n            if (!element['unitPrice']['amount']) {\r\n                delete element['unitPrice'];\r\n            }\r\n            if (!element['receivedOrderUnits']['amount']) {\r\n                delete element['receivedOrderUnits'];\r\n            }\r\n        });\r\n        this.localService.addEditRecivingGenralOrder(value, this.fromNew).pipe(take(1)).subscribe(val => {\r\n            const dialogRef = this.dialog.open(ReceiptDialog, {\r\n                width: '80%',\r\n                data: { receipt: cloneDeep(val), fromNew: true, type: 'General' }\r\n            });\r\n            dialogRef.afterClosed().subscribe(data => {\r\n                if (data === $localize `Edit receive`) {\r\n                    this.fromNew = false;\r\n                    this.isDataAvailable = false;\r\n                    this.setOrderItemsEdit(+val['poCode']['id'], val);\r\n                    this.cdRef.detectChanges();\r\n                }\r\n                // else if(data === 'Edit order') {\r\n                //     this.router.navigate(['Main/ordready/NewGenralOrder',{id: val['poCode']['id']}]);\r\n                // }\r\n                else {\r\n                    this.router.navigate(['../ReceiveGReports'], { relativeTo: this._Activatedroute });\r\n                }\r\n            });\r\n        });\r\n    }\r\n    ngOnDestroy() {\r\n        if (this.navigationSubscription) {\r\n            this.navigationSubscription.unsubscribe();\r\n        }\r\n    }\r\n}\r\nReceiveGOrder.ɵfac = function ReceiveGOrder_Factory(t) { return new (t || ReceiveGOrder)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i2.ReceiptService), i0.ɵɵdirectiveInject(i3.Genral), i0.ɵɵdirectiveInject(i4.MatDialog), i0.ɵɵdirectiveInject(i5.FormBuilder)); };\r\nReceiveGOrder.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: ReceiveGOrder, selectors: [[\"receive-g-order\"]], decls: 2, vars: 2, consts: function () { let i18n_0; if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\r\n        const MSG_EXTERNAL_3301100013772706995$$SRC_APP_RECEIPT_RECEIVE_G_ORDER_COMPONENT_TS__1 = goog.getMsg(\"PO# receving\");\r\n        i18n_0 = MSG_EXTERNAL_3301100013772706995$$SRC_APP_RECEIPT_RECEIVE_G_ORDER_COMPONENT_TS__1;\r\n    }\r\n    else {\r\n        i18n_0 = $localize `:␟012a93f02e121455f6682748a6c7df3a94d5bc4b␟3301100013772706995:PO# receving`;\r\n    } let i18n_3; if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\r\n        const MSG_EXTERNAL_7252885462474989478$$SRC_APP_RECEIPT_RECEIVE_G_ORDER_COMPONENT_TS__4 = goog.getMsg(\"Receving general order\");\r\n        i18n_3 = MSG_EXTERNAL_7252885462474989478$$SRC_APP_RECEIPT_RECEIVE_G_ORDER_COMPONENT_TS__4;\r\n    }\r\n    else {\r\n        i18n_3 = $localize `:␟9d152b8569e4363196fef136cc851e34b2b4c75f␟7252885462474989478:Receving general order`;\r\n    } return [[3, \"ngStyle\", 4, \"ngIf\"], [4, \"ngIf\"], [3, \"ngStyle\"], i18n_0, [\"dynamicField\", \"\", 3, \"field\", \"group\", 4, \"ngFor\", \"ngForOf\"], [\"dynamicField\", \"\", 3, \"field\", \"group\"], [\"mainLabel\", i18n_3, 3, \"fields\", \"putData\", \"submitForm\"]]; }, template: function ReceiveGOrder_Template(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵtemplate(0, ReceiveGOrder_fieldset_0_Template, 5, 3, \"fieldset\", 0);\r\n        i0.ɵɵtemplate(1, ReceiveGOrder_div_1_Template, 2, 2, \"div\", 1);\r\n    } if (rf & 2) {\r\n        i0.ɵɵproperty(\"ngIf\", ctx.isFirstDataAvailable);\r\n        i0.ɵɵadvance(1);\r\n        i0.ɵɵproperty(\"ngIf\", ctx.isDataAvailable);\r\n    } }, directives: [i6.NgIf, i6.NgStyle, i6.NgForOf, i7.DynamicFieldDirective, i8.DynamicFormComponent], encapsulation: 2 });\r\n"]},"metadata":{},"sourceType":"module"}