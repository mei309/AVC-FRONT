{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport { NavigationEnd } from '@angular/router';\nimport { take } from 'rxjs/operators';\nimport { OrderDetailsDialogComponent } from './order-details-dialog-component';\nimport { cloneDeep } from 'lodash-es';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"./orders.service\";\nimport * as i3 from \"../genral.service\";\nimport * as i4 from \"@angular/material/dialog\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"../components/dynamic-form/dynamic-form.component\";\n\nfunction NewGenralOrder_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"dynamic-form\", 1);\n    i0.ɵɵlistener(\"submitForm\", function NewGenralOrder_div_0_Template_dynamic_form_submitForm_1_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return ctx_r1.submit($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"putData\", ctx_r0.putData)(\"fields\", ctx_r0.regConfig);\n  }\n}\n\nexport class NewGenralOrder {\n  constructor(router, _Activatedroute, cdRef, localService, genral, dialog) {\n    this.router = router;\n    this._Activatedroute = _Activatedroute;\n    this.cdRef = cdRef;\n    this.localService = localService;\n    this.genral = genral;\n    this.dialog = dialog;\n    this.putData = null;\n    this.isDataAvailable = false;\n  }\n\n  ngOnInit() {\n    this.regConfig = [{\n      type: 'selectgroup',\n      inputType: 'supplierName',\n      options: this.localService.findFreeGeneralPoCodes(),\n      disable: true,\n      collections: [{\n        type: 'select',\n        label: \"Supplier\"\n      }, {\n        type: 'select',\n        label: \"#PO\",\n        name: 'poCode',\n        collections: 'somewhere',\n        validations: [{\n          name: 'required',\n          validator: Validators.required,\n          message: \"PO code Required\"\n        }]\n      }]\n    }, {\n      type: 'date',\n      label: \"Contract date\",\n      value: 'timeNow',\n      name: 'recordedTime',\n      options: 'withTime' // disable: true,\n\n    }, {\n      type: 'input',\n      label: \"Person in charge\",\n      name: 'personInCharge',\n      inputType: 'text'\n    }, {\n      type: 'bigexpand',\n      label: \"Orderd products\",\n      name: 'orderItems',\n      value: 'required',\n      collections: [{\n        type: 'select',\n        label: \"Item descrption\",\n        name: 'item',\n        collections: 'somewhere',\n        options: this.genral.getItemsGeneral() // disable: true,\n\n      }, {\n        type: 'calculatefew',\n        label: \"price\",\n        inputType: '*',\n        collections: [{\n          type: 'inputselect',\n          name: 'numberUnits',\n          options: 'item',\n          inputType: 'second',\n          collections: [{\n            type: 'input',\n            label: \"Amount\",\n            name: 'amount',\n            inputType: 'numeric',\n            options: 3\n          }, {\n            type: 'select',\n            label: \"Weight unit\",\n            name: 'measureUnit',\n            options: this.genral.getMeasureUnit()\n          }]\n        }, {\n          type: 'inputselect',\n          name: 'unitPrice',\n          collections: [{\n            type: 'input',\n            label: \"Price per unit\",\n            name: 'amount',\n            inputType: 'numeric',\n            options: 3\n          }, {\n            type: 'select',\n            label: \"Currency\",\n            name: 'currency',\n            options: ['VND', 'USD']\n          }]\n        }]\n      }, {\n        type: 'date',\n        label: \"Delivery date\",\n        name: 'deliveryDate' // value: new Date()\n\n      }, {\n        type: 'textarry',\n        label: \"Remarks\",\n        inputType: 'text',\n        name: 'remarks'\n      }, {\n        type: 'divider',\n        inputType: 'divide'\n      }],\n      validations: [{\n        name: 'numberUnits',\n        message: \"a orderd item must have weight and price and delivery date\"\n      }, {\n        name: 'unitPrice'\n      }, {\n        name: 'deliveryDate'\n      }]\n    }, {\n      type: 'button',\n      label: \"Submit\",\n      name: 'submit'\n    }];\n\n    this._Activatedroute.paramMap.pipe(take(1)).subscribe(params => {\n      if (params.get('id')) {\n        var id = +params.get('id');\n        this.localService.getOrderPO(id).pipe(take(1)).subscribe(val => {\n          this.putData = val;\n          this.isDataAvailable = true;\n        });\n      } else {\n        this.isDataAvailable = true;\n      }\n    });\n\n    this.navigationSubscription = this.router.events.subscribe(e => {\n      // If it is a NavigationEnd event re-initalise the component\n      if (e instanceof NavigationEnd) {\n        this.isDataAvailable = false;\n        this.putData = null;\n        this.cdRef.detectChanges();\n        this.isDataAvailable = true;\n      }\n    });\n  }\n\n  submit(value) {\n    value['orderItems'].forEach(element => {\n      if (!element['unitPrice']['amount']) {\n        delete element['unitPrice'];\n      }\n    });\n    const fromNew = this.putData === null || this.putData === undefined;\n    this.localService.addEditGenralOrder(value, fromNew).pipe(take(1)).subscribe(val => {\n      const dialogRef = this.dialog.open(OrderDetailsDialogComponent, {\n        width: '80%',\n        data: {\n          order: cloneDeep(val),\n          fromNew: true,\n          type: 'General'\n        }\n      });\n      dialogRef.afterClosed().subscribe(data => {\n        if (data === \"Edit order\") {\n          this.putData = val;\n          this.isDataAvailable = false;\n          this.cdRef.detectChanges();\n          this.isDataAvailable = true;\n        } else if (data === \"Receive\") {\n          this.router.navigate(['Main/receiptready/ReceiveGOrder', {\n            poCode: val['poCode']['id']\n          }]);\n        } else {\n          this.router.navigate(['../OrdersGReports'], {\n            relativeTo: this._Activatedroute\n          });\n        }\n      });\n    });\n  }\n\n  ngOnDestroy() {\n    if (this.navigationSubscription) {\n      this.navigationSubscription.unsubscribe();\n    }\n  }\n\n}\n\nNewGenralOrder.ɵfac = function NewGenralOrder_Factory(t) {\n  return new (t || NewGenralOrder)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i2.OrdersService), i0.ɵɵdirectiveInject(i3.Genral), i0.ɵɵdirectiveInject(i4.MatDialog));\n};\n\nNewGenralOrder.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: NewGenralOrder,\n  selectors: [[\"new-genral-order\"]],\n  decls: 1,\n  vars: 1,\n  consts: function () {\n    let i18n_0;\n\n    if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n      const MSG_EXTERNAL_5600409771356185735$$SRC_APP_ORDERS_NEW_G_ORDER_COMPONENT_TS__1 = goog.getMsg(\"General order\");\n      i18n_0 = MSG_EXTERNAL_5600409771356185735$$SRC_APP_ORDERS_NEW_G_ORDER_COMPONENT_TS__1;\n    } else {\n      i18n_0 = \"General order\";\n    }\n\n    return [[4, \"ngIf\"], [\"mainLabel\", i18n_0, 3, \"putData\", \"fields\", \"submitForm\"]];\n  },\n  template: function NewGenralOrder_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, NewGenralOrder_div_0_Template, 2, 2, \"div\", 0);\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.isDataAvailable);\n    }\n  },\n  directives: [i5.NgIf, i6.DynamicFormComponent],\n  encapsulation: 2\n});","map":{"version":3,"sources":["C:/Users/isral/OneDrive/Documents/AVC-FRONT/src/app/orders/new-g-order.component.ts"],"names":["Validators","NavigationEnd","take","OrderDetailsDialogComponent","cloneDeep","i0","i1","i2","i3","i4","i5","i6","NewGenralOrder_div_0_Template","rf","ctx","_r2","ɵɵgetCurrentView","ɵɵelementStart","ɵɵlistener","NewGenralOrder_div_0_Template_dynamic_form_submitForm_1_listener","$event","ɵɵrestoreView","ctx_r1","ɵɵnextContext","submit","ɵɵelementEnd","ctx_r0","ɵɵadvance","ɵɵproperty","putData","regConfig","NewGenralOrder","constructor","router","_Activatedroute","cdRef","localService","genral","dialog","isDataAvailable","ngOnInit","type","inputType","options","findFreeGeneralPoCodes","disable","collections","label","name","validations","validator","required","message","value","getItemsGeneral","getMeasureUnit","paramMap","pipe","subscribe","params","get","id","getOrderPO","val","navigationSubscription","events","e","detectChanges","forEach","element","fromNew","undefined","addEditGenralOrder","dialogRef","open","width","data","order","afterClosed","navigate","poCode","relativeTo","ngOnDestroy","unsubscribe","ɵfac","NewGenralOrder_Factory","t","ɵɵdirectiveInject","Router","ActivatedRoute","ChangeDetectorRef","OrdersService","Genral","MatDialog","ɵcmp","ɵɵdefineComponent","selectors","decls","vars","consts","i18n_0","ngI18nClosureMode","MSG_EXTERNAL_5600409771356185735$$SRC_APP_ORDERS_NEW_G_ORDER_COMPONENT_TS__1","goog","getMsg","template","NewGenralOrder_Template","ɵɵtemplate","directives","NgIf","DynamicFormComponent","encapsulation"],"mappings":"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","sourcesContent":["import { Validators } from '@angular/forms';\r\nimport { NavigationEnd } from '@angular/router';\r\nimport { take } from 'rxjs/operators';\r\nimport { OrderDetailsDialogComponent } from './order-details-dialog-component';\r\nimport { cloneDeep } from 'lodash-es';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@angular/router\";\r\nimport * as i2 from \"./orders.service\";\r\nimport * as i3 from \"../genral.service\";\r\nimport * as i4 from \"@angular/material/dialog\";\r\nimport * as i5 from \"@angular/common\";\r\nimport * as i6 from \"../components/dynamic-form/dynamic-form.component\";\r\nfunction NewGenralOrder_div_0_Template(rf, ctx) { if (rf & 1) {\r\n    const _r2 = i0.ɵɵgetCurrentView();\r\n    i0.ɵɵelementStart(0, \"div\");\r\n    i0.ɵɵelementStart(1, \"dynamic-form\", 1);\r\n    i0.ɵɵlistener(\"submitForm\", function NewGenralOrder_div_0_Template_dynamic_form_submitForm_1_listener($event) { i0.ɵɵrestoreView(_r2); const ctx_r1 = i0.ɵɵnextContext(); return ctx_r1.submit($event); });\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const ctx_r0 = i0.ɵɵnextContext();\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"putData\", ctx_r0.putData)(\"fields\", ctx_r0.regConfig);\r\n} }\r\nexport class NewGenralOrder {\r\n    constructor(router, _Activatedroute, cdRef, localService, genral, dialog) {\r\n        this.router = router;\r\n        this._Activatedroute = _Activatedroute;\r\n        this.cdRef = cdRef;\r\n        this.localService = localService;\r\n        this.genral = genral;\r\n        this.dialog = dialog;\r\n        this.putData = null;\r\n        this.isDataAvailable = false;\r\n    }\r\n    ngOnInit() {\r\n        this.regConfig = [\r\n            {\r\n                type: 'selectgroup',\r\n                inputType: 'supplierName',\r\n                options: this.localService.findFreeGeneralPoCodes(),\r\n                disable: true,\r\n                collections: [\r\n                    {\r\n                        type: 'select',\r\n                        label: $localize `Supplier`,\r\n                    },\r\n                    {\r\n                        type: 'select',\r\n                        label: $localize `#PO`,\r\n                        name: 'poCode',\r\n                        collections: 'somewhere',\r\n                        validations: [\r\n                            {\r\n                                name: 'required',\r\n                                validator: Validators.required,\r\n                                message: $localize `PO code Required`,\r\n                            }\r\n                        ]\r\n                    },\r\n                ]\r\n            },\r\n            {\r\n                type: 'date',\r\n                label: $localize `Contract date`,\r\n                value: 'timeNow',\r\n                name: 'recordedTime',\r\n                options: 'withTime',\r\n                // disable: true,\r\n            },\r\n            {\r\n                type: 'input',\r\n                label: $localize `Person in charge`,\r\n                name: 'personInCharge',\r\n                inputType: 'text',\r\n            },\r\n            {\r\n                type: 'bigexpand',\r\n                label: $localize `Orderd products`,\r\n                name: 'orderItems',\r\n                value: 'required',\r\n                collections: [\r\n                    {\r\n                        type: 'select',\r\n                        label: $localize `Item descrption`,\r\n                        name: 'item',\r\n                        collections: 'somewhere',\r\n                        options: this.genral.getItemsGeneral(),\r\n                        // disable: true,\r\n                    },\r\n                    {\r\n                        type: 'calculatefew',\r\n                        label: $localize `price`,\r\n                        inputType: '*',\r\n                        collections: [\r\n                            {\r\n                                type: 'inputselect',\r\n                                name: 'numberUnits',\r\n                                options: 'item',\r\n                                inputType: 'second',\r\n                                collections: [\r\n                                    {\r\n                                        type: 'input',\r\n                                        label: $localize `Amount`,\r\n                                        name: 'amount',\r\n                                        inputType: 'numeric',\r\n                                        options: 3,\r\n                                    },\r\n                                    {\r\n                                        type: 'select',\r\n                                        label: $localize `Weight unit`,\r\n                                        name: 'measureUnit',\r\n                                        options: this.genral.getMeasureUnit(),\r\n                                    },\r\n                                ]\r\n                            },\r\n                            {\r\n                                type: 'inputselect',\r\n                                name: 'unitPrice',\r\n                                collections: [\r\n                                    {\r\n                                        type: 'input',\r\n                                        label: $localize `Price per unit`,\r\n                                        name: 'amount',\r\n                                        inputType: 'numeric',\r\n                                        options: 3,\r\n                                    },\r\n                                    {\r\n                                        type: 'select',\r\n                                        label: $localize `Currency`,\r\n                                        name: 'currency',\r\n                                        options: ['VND', 'USD'],\r\n                                    },\r\n                                ]\r\n                            },\r\n                        ]\r\n                    },\r\n                    {\r\n                        type: 'date',\r\n                        label: $localize `Delivery date`,\r\n                        name: 'deliveryDate',\r\n                        // value: new Date()\r\n                    },\r\n                    {\r\n                        type: 'textarry',\r\n                        label: $localize `Remarks`,\r\n                        inputType: 'text',\r\n                        name: 'remarks',\r\n                    },\r\n                    {\r\n                        type: 'divider',\r\n                        inputType: 'divide'\r\n                    },\r\n                ],\r\n                validations: [\r\n                    {\r\n                        name: 'numberUnits',\r\n                        message: $localize `a orderd item must have weight and price and delivery date`,\r\n                    },\r\n                    {\r\n                        name: 'unitPrice',\r\n                    },\r\n                    {\r\n                        name: 'deliveryDate',\r\n                    },\r\n                ]\r\n            },\r\n            {\r\n                type: 'button',\r\n                label: $localize `Submit`,\r\n                name: 'submit',\r\n            }\r\n        ];\r\n        this._Activatedroute.paramMap.pipe(take(1)).subscribe(params => {\r\n            if (params.get('id')) {\r\n                var id = +params.get('id');\r\n                this.localService.getOrderPO(id).pipe(take(1)).subscribe(val => {\r\n                    this.putData = val;\r\n                    this.isDataAvailable = true;\r\n                });\r\n            }\r\n            else {\r\n                this.isDataAvailable = true;\r\n            }\r\n        });\r\n        this.navigationSubscription = this.router.events.subscribe((e) => {\r\n            // If it is a NavigationEnd event re-initalise the component\r\n            if (e instanceof NavigationEnd) {\r\n                this.isDataAvailable = false;\r\n                this.putData = null;\r\n                this.cdRef.detectChanges();\r\n                this.isDataAvailable = true;\r\n            }\r\n        });\r\n    }\r\n    submit(value) {\r\n        value['orderItems'].forEach(element => {\r\n            if (!element['unitPrice']['amount']) {\r\n                delete element['unitPrice'];\r\n            }\r\n        });\r\n        const fromNew = this.putData === null || this.putData === undefined;\r\n        this.localService.addEditGenralOrder(value, fromNew).pipe(take(1)).subscribe(val => {\r\n            const dialogRef = this.dialog.open(OrderDetailsDialogComponent, {\r\n                width: '80%',\r\n                data: { order: cloneDeep(val), fromNew: true, type: 'General' }\r\n            });\r\n            dialogRef.afterClosed().subscribe(data => {\r\n                if (data === $localize `Edit order`) {\r\n                    this.putData = val;\r\n                    this.isDataAvailable = false;\r\n                    this.cdRef.detectChanges();\r\n                    this.isDataAvailable = true;\r\n                }\r\n                else if (data === $localize `Receive`) {\r\n                    this.router.navigate(['Main/receiptready/ReceiveGOrder', { poCode: val['poCode']['id'] }]);\r\n                }\r\n                else {\r\n                    this.router.navigate(['../OrdersGReports'], { relativeTo: this._Activatedroute });\r\n                }\r\n            });\r\n        });\r\n    }\r\n    ngOnDestroy() {\r\n        if (this.navigationSubscription) {\r\n            this.navigationSubscription.unsubscribe();\r\n        }\r\n    }\r\n}\r\nNewGenralOrder.ɵfac = function NewGenralOrder_Factory(t) { return new (t || NewGenralOrder)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i2.OrdersService), i0.ɵɵdirectiveInject(i3.Genral), i0.ɵɵdirectiveInject(i4.MatDialog)); };\r\nNewGenralOrder.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: NewGenralOrder, selectors: [[\"new-genral-order\"]], decls: 1, vars: 1, consts: function () { let i18n_0; if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\r\n        const MSG_EXTERNAL_5600409771356185735$$SRC_APP_ORDERS_NEW_G_ORDER_COMPONENT_TS__1 = goog.getMsg(\"General order\");\r\n        i18n_0 = MSG_EXTERNAL_5600409771356185735$$SRC_APP_ORDERS_NEW_G_ORDER_COMPONENT_TS__1;\r\n    }\r\n    else {\r\n        i18n_0 = $localize `:␟c399584d8411f96f835da3874b55e50c738723f9␟5600409771356185735:General order`;\r\n    } return [[4, \"ngIf\"], [\"mainLabel\", i18n_0, 3, \"putData\", \"fields\", \"submitForm\"]]; }, template: function NewGenralOrder_Template(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵtemplate(0, NewGenralOrder_div_0_Template, 2, 2, \"div\", 0);\r\n    } if (rf & 2) {\r\n        i0.ɵɵproperty(\"ngIf\", ctx.isDataAvailable);\r\n    } }, directives: [i5.NgIf, i6.DynamicFormComponent], encapsulation: 2 });\r\n"]},"metadata":{},"sourceType":"module"}